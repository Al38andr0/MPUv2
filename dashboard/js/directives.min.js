angular.module("mpuDashboard").directive("fileread",[function(){return{scope:{fileread:"="},link:function(c,b,a){b.bind("change",function(e){var d=new FileReader();d.onload=function(f){c.$apply(function(){c.fileread=f.target.result})};d.readAsDataURL(e.target.files[0])})}}}]);angular.module("mpuDashboard").directive("categorie",function(){return{restrict:"E",templateUrl:"template/categorie.html",scope:{categoriaOriginal:"=",vm:"="},controller:function(b,d,c,a){console.log(b.categoriaOriginal);b.$watch("categoriaOriginal",function(e){b.cat=angular.copy(e.categoria);b.cat.r="../dashboard/archivio_dati/Categorie/"+b.cat.i+".jpg"});b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.cat.n||!b.cat.r||!b.cat.x||isNaN(b.cat.y))};b.newItem=function(){b.categoriaOriginal.selected=false;a.saving=false;b.vm.nuovaCategoria={i:b.vm.nuovaCategoria.i+1,v:1,r:false}};b.action=function(e){if(e=="U"){a.saving=true;d.post("php/categorie.php?type=update",{id:b.cat.i,nome:b.cat.n,pos:b.cat.y,show:b.cat.v,text:b.cat.x,image:b.cat.r}).success(function(f){b.vm.saveCategorieData();_.each(b.vm.categorie,function(g){if(g.i==b.cat.i){g.n=b.cat.n;g.y=b.cat.y;g.v=b.cat.v;g.r=b.cat.r;g.x=b.cat.x;b.cat=angular.copy(g);delete g.r}});a.saving=false}).error(function(g,f){console.log(f)})}if(e=="D"){a.saving=true;d.post("php/categorie.php?type=delete",{id:b.cat.i,nome:b.cat.n,pos:b.cat.y,show:b.cat.v,text:b.cat.x,image:b.cat.r}).success(function(f){b.vm.categorie=_.filter(b.vm.categorie,function(g){return g.i!=b.cat.i});b.vm.saveCategorieData();b.newItem()}).error(function(g,f){console.log(f)})}}}}});angular.module("mpuDashboard").directive("settori",function(){return{restrict:"E",templateUrl:"template/settori.html",scope:{settoreOriginal:"=",vm:"="},controller:function(b,d,c,a){b.$watch("settoreOriginal",function(e){b.set=angular.copy(e.settore);b.set.r="../dashboard/archivio_dati/Settori/"+b.set.i+".jpg"});b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.set.n||!b.set.x||isNaN(b.set.y))};b.newSettore=function(){b.settoreOriginal.selected=false;a.saving=false;b.vm.nuovoSettore={i:b.vm.nuovoSettore.i+1,v:1,o:1,g:false,r:false}};b.action=function(e){if(e=="U"){a.saving=true;d.post("php/settori.php?type=update",{id:b.set.i,nome:b.set.n,pos:b.set.y,show:b.set.v,cat:b.set.g,image:b.set.r,text:b.set.x,home:b.set.o}).success(function(f){b.vm.saveSettoriData();_.each(b.vm.settori,function(g){if(g.i==b.set.i){g.n=b.set.n;g.y=b.set.y;g.v=b.set.v;g.g=b.set.g;g.r=b.set.r;g.x=b.set.x;g.o=b.set.o;b.set=angular.copy(g);delete g.r}});a.saving=false}).error(function(g,f){console.log(f)})}if(e=="D"){a.saving=true;d.post("php/settori.php?type=delete",{id:b.set.i,nome:b.set.n,pos:b.set.y,show:b.set.v,cat:b.set.g,image:b.set.r,text:b.set.x,home:b.set.o}).success(function(f){b.vm.settori=_.filter(b.vm.settori,function(g){return g.i!=b.set.i});b.vm.saveSettoriData();b.newSettore()}).error(function(g,f){console.log(f)})}}}}});angular.module("mpuDashboard").directive("marchi",function(){return{restrict:"E",templateUrl:"template/marchi.html",scope:{marchioOriginal:"=",vm:"="},controller:function(b,e,c,a){b.$watch("marchioOriginal",function(f){b.mark=angular.copy(f.marchio)});b.errore={marchio:false};b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.selectedCat=function(f){return(b.mark.g.indexOf(f)!=-1)};b.toggleSet=function(f){if(b.mark.g.indexOf(f)==-1){b.mark.g.push(parseInt(f))}else{b.mark.g.splice(b.mark.g.indexOf(f),1)}};b.updateCheck=function(){return(!b.mark.n||b.mark.g.length==0||isNaN(b.mark.b)||isNaN(b.mark.s))};b.deleteCheck=function(){return(b.mark.n!==b.marchioOriginal.marchio.n)};var d=function(){if(b.mark.n!==b.marchioOriginal.marchio.n){return _.findWhere(b.vm.marchi,{n:b.mark.n})}else{return false}};b.newMarchio=function(){b.marchioOriginal.selected=false;a.saving=false;b.errore.marchio=false;b.vm.nuovoMarchio={i:b.vm.nuovoMarchio.i+1,v:1,g:[],b:0,s:0}};b.action=function(f){if(f=="U"){if(!d()){a.saving=true;e.post("php/marchi.php?type=update",{id:b.mark.i,nome:b.mark.n,show:b.mark.v,list:b.mark.b,disc:b.mark.s,cat_array:b.mark.g}).success(function(g){b.vm.saveMarchiData();_.each(b.vm.marchi,function(h){if(h.i==b.mark.i){h.n=b.mark.n;h.v=b.mark.v;h.g=b.mark.g;h.b=b.mark.b;h.s=b.mark.s;b.mark=angular.copy(h)}return b.vm.marchi});b.errore.marchio=false;a.saving=false}).error(function(h,g){console.log(g)})}else{b.errore.marchio=true}}if(f=="D"){a.saving=true;e.post("php/marchi.php?type=delete",{id:b.mark.i,nome:b.mark.n,show:b.mark.v,list:b.mark.b,disc:b.mark.s,cat_array:b.mark.g}).success(function(g){b.vm.marchi=_.filter(b.vm.marchi,function(h){return h.i!=b.mark.i});b.vm.saveMarchiData();b.newMarchio()}).error(function(h,g){console.log(g)})}}}}});angular.module("mpuDashboard").directive("tbpr",function(){return{restrict:"E",templateUrl:"template/marchiTabelle.html",scope:{tbprOriginal:"=",vm:"="},controller:function(b,e,c,a){b.$watch("tbprOriginal",function(f){b.tbpr=angular.copy(f.tbpr)});b.errore={tbpr:false};b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.tbpr.n||isNaN(b.tbpr.y))};b.copyCheck=function(){return(!b.tbpr.n||isNaN(b.tbpr.y)||(b.tbpr.n===b.tbprOriginal.tbpr.n&&b.tbpr.m===b.tbprOriginal.tbpr.m))};b.newTbpr=function(){b.tbprOriginal.selected=false;a.saving=false;b.errore.tbpr=false;b.vm.nuovaTbpr={i:b.vm.nuovaTbpr.i+1,m:false,y:1}};var d=function(){if(b.tbpr.n!=b.tbprOriginal.tbpr.n||b.tbpr.m!=b.tbprOriginal.tbpr.m){return _.findWhere(b.vm.tbpr,{n:b.tbpr.n,m:b.tbpr.m})}else{return false}};b.checkCopy=function(){return _.findWhere(b.vm.tbpr,{n:b.tbpr.n,m:b.tbpr.m})};b.action=function(f){if(f=="U"){if(!d()){a.saving=true;e.post("php/marchiTabelle.php?type=update",{id:b.tbpr.i,nome:b.tbpr.n,pos:b.tbpr.y,mark:b.tbpr.m}).success(function(g){b.vm.saveTbprData();_.each(b.vm.tbpr,function(h){if(h.i==b.tbpr.i){h.n=b.tbpr.n;h.m=b.tbpr.m;h.y=b.tbpr.y;b.tbpr=angular.copy(h)}});a.saving=false;b.errore.tbpr=false}).error(function(h,g){console.log(g)})}else{b.errore.tbpr=true}}if(f=="C"){if(!d()){a.saving=true;e.post("php/marchiTabelle.php?type=new",{id:b.vm.nuovaTbpr.i,nome:b.tbpr.n,pos:b.tbpr.y,mark:b.tbpr.m}).success(function(g){b.vm.copiedTbpr={i:b.vm.nuovaTbpr.i,n:b.tbpr.n,y:b.tbpr.y,m:b.tbpr.m};b.vm.tbpr.push(b.vm.copiedTbpr);b.vm.saveTbprData();b.vm.nuovaTbpr={i:b.vm.nuovaTbpr.i+1};a.saving=false;b.errore.tbpr=false}).error(function(h,g){console.log(g)})}else{b.errore.tbpr=true}}if(f=="D"){a.saving=true;e.post("php/marchiTabelle.php?type=delete",{id:b.tbpr.i,nome:b.tbpr.n,pos:b.tbpr.y,mark:b.tbpr.m}).success(function(g){b.vm.tbpr=_.filter(b.vm.tbpr,function(h){return h.i!=b.tbpr.i});b.vm.saveTbprData();b.newTbpr()}).error(function(h,g){console.log(g)})}}}}});angular.module("mpuDashboard").directive("finiture",function(){return{restrict:"E",templateUrl:"template/finiture.html",scope:{finituraOriginal:"=",vm:"="},controller:function(d,h,f,c){d.errore={finitura:false};function b(i){_.each(d.vm.marchi,function(j){if(j.i==i){markByName=j.n}});return markByName}function a(i,k,j){return i.replace(new RegExp(k,"g"),j)}d.$watch("finituraOriginal",function(i){d.finitura=angular.copy(i.finitura);var j=b(d.finitura.m);j=a(j," ","_");var k=a(d.finitura.n," ","_");var l=k+"_"+d.finitura.c.replace(" ","_")+".jpg";d.finitura.r="../dashboard/archivio_dati/"+j+"/Finiture/"+l});d.confirm=false;d.askConfirm=function(){d.confirm=true;f(function(){d.confirm=false},4000)};d.updateCheck=function(){return(!d.finitura.n||!d.finitura.c||!d.finitura.m)};d.deleteCheck=function(){return(d.finitura.n!==d.finituraOriginal.finitura.n||d.finitura.c!==d.finituraOriginal.finitura.c||d.finitura.m!==d.finituraOriginal.finitura.m)};d.copyCheck=function(){return(!d.finitura.n||!d.finitura.c||!d.finitura.m||(d.finitura.n===d.finituraOriginal.finitura.n&&d.finitura.c===d.finituraOriginal.finitura.c))};var e=function(){if(d.finitura.n!=d.finituraOriginal.finitura.n||d.finitura.c!=d.finituraOriginal.finitura.c||d.finitura.m!=d.finituraOriginal.finitura.m){return _.findWhere(d.vm.finiture,{n:d.finitura.n,c:d.finitura.c,m:d.finitura.m})}else{return false}};var g=function(){return _.findWhere(d.vm.finiture,{n:d.finitura.n,c:d.finitura.c,m:d.finitura.m})};d.newFinitura=function(){c.saving=false;d.errore.finitura=false;d.finituraOriginal.selected=false;d.vm.nuovaFinitura={i:d.vm.nuovaFinitura.i+1,v:1,p:0,m:false,r:false}};d.action=function(i){if(i=="U"){if(!e()){c.saving=true;h.post("php/finiture.php?type=update",{id:d.finitura.i,nome:d.finitura.n,cod:d.finitura.c,show:d.finitura.v,mark:d.finitura.m,type:d.finitura.p,image:d.finitura.r,sourceNome:d.finituraOriginal.finitura.n,sourceCod:d.finituraOriginal.finitura.c,sourceMark:d.finituraOriginal.finitura.m}).success(function(j){d.errore.finitura=false;d.vm.saveFinituraData();console.log("Risposta dalla pagina PHP",j);_.each(d.vm.finiture,function(k){if(k.i==d.finitura.i){k.n=d.finitura.n;k.m=d.finitura.m;k.c=d.finitura.c;k.r=d.finitura.r;k.p=d.finitura.p;k.v=d.finitura.v;d.finitura=angular.copy(k)}});c.saving=false;d.errore.finitura=false}).error(function(k,j){console.log(j)})}else{d.errore.finitura=true}}if(i=="C"){if(!g()){c.saving=true;h.post("php/finiture.php?type=new",{id:d.vm.nuovaFinitura.i,nome:d.finitura.n,cod:d.finitura.c,show:d.finitura.v,mark:d.finitura.m,type:d.finitura.p,image:d.finitura.r,sourceNome:d.finituraOriginal.finitura.n,sourceCod:d.finituraOriginal.finitura.c,sourceMark:d.finituraOriginal.finitura.m}).success(function(j){d.vm.copiedfinitura={i:d.vm.nuovaFinitura.i,n:d.finitura.n,c:d.finitura.c,v:d.finitura.v,m:d.finitura.m,p:d.finitura.p};d.vm.finiture.push(d.vm.copiedfinitura);d.vm.nuovaFinitura={i:d.vm.nuovaFinitura.i+1};d.vm.saveFinituraData();c.saving=false;d.errore.finitura=false}).error(function(k,j){console.log(j)})}else{d.errore.finitura=true}}if(i=="D"){c.saving=true;h.post("php/finiture.php?type=delete",{id:d.finitura.i,nome:d.finitura.n,cod:d.finitura.c,show:d.finitura.v,mark:d.finitura.m,type:d.finitura.p,image:d.finitura.r}).success(function(j){d.vm.finiture=_.filter(d.vm.finiture,function(k){return k.i!=d.finitura.i});d.vm.saveFinituraData();d.newFinitura()}).error(function(k,j){console.log(j)})}}}}});angular.module("mpuDashboard").directive("linee",function(){return{restrict:"E",templateUrl:"template/linee.html",scope:{lineaOriginal:"=",vm:"="},controller:function(d,g,e,c){d.errore={linea:false};d.priceName=[{n:"economico",i:2},{n:"design",i:3},{n:"top class",i:4}];function b(h){_.each(d.vm.marchi,function(i){if(i.i==h){markByName=i.n}});return markByName}function a(h,j,i){return h.replace(new RegExp(j,"g"),i)}d.$watch("lineaOriginal",function(i){d.linea=angular.copy(i.linea);var k=b(d.linea.m);k=a(k," ","_");lineaName=a(d.linea.n," ","_");var h=d.linea.n.replace(" ","_")+"_specifiche.pdf";var j=d.linea.n.replace(" ","_")+"_catalogo.pdf";var l=d.linea.n.replace(" ","_")+".jpg";d.linea.ctlPath="../dashboard/archivio_dati/"+k+"/"+lineaName+"/"+j;d.linea.jPath="../dashboard/archivio_dati/"+k+"/"+lineaName+"/"+h;d.linea.r="../dashboard/archivio_dati/"+k+"/"+lineaName+"/"+l});d.confirm=false;d.askConfirm=function(){d.confirm=true;e(function(){d.confirm=false},4000)};d.updateCheck=function(){return(!d.linea.n||isNaN(d.linea.e)||isNaN(d.linea.w)||isNaN(d.linea.s)||!d.linea.m)};d.deleteCheck=function(){return(d.linea.n!==d.lineaOriginal.linea.n||d.linea.m!==d.lineaOriginal.linea.m)};var f=function(){if(d.linea.n!=d.lineaOriginal.linea.n||d.linea.m!=d.lineaOriginal.linea.m){return _.findWhere(d.vm.linee,{n:d.linea.n,m:d.linea.m})}else{return false}};d.addLink=function(){d.linea.a.push(false)};d.removeLink=function(h){if(d.linea.a.length==1){d.linea.a=[false]}else{d.linea.a.splice(h,1)}};d.selectedCat=function(h){return(d.linea.q.indexOf(h)!=-1)};d.toggleSet=function(h){if(d.linea.q.indexOf(h)==-1){d.linea.q.push(parseInt(h))}else{d.linea.q.splice(d.linea.q.indexOf(h),1)}};d.newLinea=function(){c.saving=false;d.errore.linea=false;d.lineaOriginal.selected=false;d.vm.nuovaLinea={i:d.vm.nuovaLinea.i+1,q:[],a:[false],v:1,z:2,b:0,y:100,c:0,s:0,e:25,w:2,r:false,k:false,j:false}};d.action=function(h){if(h=="U"){if(!f()){c.saving=true;g.post("php/linee.php?type=update",{id:d.linea.i,nome:d.linea.n,mark:d.linea.m,disc:d.linea.s,time:d.linea.e,war:d.linea.w,ctl:d.linea.k,spc:d.linea.j,image:d.linea.r,show:d.linea.v,price:d.linea.z,cat:d.linea.g,set:d.linea.q,link:d.linea.a,vtr:d.linea.c,pos:d.linea.y,sourceNome:d.lineaOriginal.linea.n,sourceMark:d.lineaOriginal.linea.m,sourceCtl:d.lineaOriginal.linea.k,sourceSpc:d.lineaOriginal.linea.j}).success(function(i){d.errore.linea=false;d.vm.saveLineaData();console.log("Risposta dalla pagina PHP",i);_.each(d.vm.linee,function(j){if(j.i==d.linea.i){j.n=d.linea.n;j.m=d.linea.m;j.e=d.linea.e;j.w=d.linea.w;j.j=d.linea.j;j.k=d.linea.k;j.s=d.linea.s;j.r=d.linea.r;j.v=d.linea.v;j.z=d.linea.z;j.g=d.linea.g;j.y=d.linea.y;j.a=d.linea.a;j.c=d.linea.c;d.linea=angular.copy(j)}return d.vm.linee});c.saving=false;d.errore.linea=false}).error(function(j,i){console.log(i)})}else{d.errore.linea=true}}if(h=="D"){c.saving=true;g.post("php/linee.php?type=delete",{id:d.linea.i,nome:d.linea.n,mark:d.linea.m,disc:d.linea.s,time:d.linea.e,war:d.linea.w,ctl:d.linea.k,spc:d.linea.j,image:d.linea.r,show:d.linea.v,price:d.linea.z,cat:d.linea.g,set:d.linea.q,link:d.linea.a,vtr:d.linea.c,pos:d.linea.y}).success(function(i){console.log("Risposta dalla pagina PHP",i);d.vm.linee=_.filter(d.vm.linee,function(j){return j.i!=d.linea.i});d.vm.saveLineaData();d.newLinea()}).error(function(j,i){console.log(i)})}}}}});angular.module("mpuDashboard").directive("finitureTabelle",function(){return{restrict:"E",templateUrl:"template/finitureTabelle.html",scope:{finituraTabellaOriginal:"=",vm:"="},controller:function(b,f,d,a){b.$watch("finituraTabellaOriginal",function(g){b.finituraTabella=angular.copy(g.finituraTabella)});b.errore={finituraTabella:false};b.confirm=false;b.askConfirm=function(){b.confirm=true;d(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.finituraTabella.n||!b.finituraTabella.m||!b.finituraTabella.l)};b.copyCheck=function(){return(!b.finituraTabella.n||!b.finituraTabella.m||!b.finituraTabella.l||(b.finituraTabella.n===b.finituraTabellaOriginal.finituraTabella.n&&b.finituraTabella.m===b.finituraTabellaOriginal.finituraTabella.m&&b.finituraTabella.l===b.finituraTabellaOriginal.finituraTabella.l))};b.newFinituraTabella=function(){a.saving=false;b.errore.finituraTabella=false;b.finituraTabellaOriginal.selected=false;b.vm.nuovaFinituraTabella={i:b.vm.nuovaFinituraTabella.i+1,m:false,l:false}};var c=function(){if(b.finituraTabella.n!=b.finituraTabellaOriginal.finituraTabella.n||b.finituraTabella.m!=b.finituraTabellaOriginal.finituraTabella.m||b.finituraTabella.l!=b.finituraTabellaOriginal.finituraTabella.l){return _.findWhere(b.vm.finitureTabelle,{n:b.finituraTabella.n,m:b.finituraTabella.m,l:b.finituraTabella.l})}else{return false}};var e=function(){return _.findWhere(b.vm.finitureTabelle,{n:b.finituraTabella.n,m:b.finituraTabella.m,l:b.finituraTabella.l})};b.action=function(g){if(g=="U"){if(!c()){a.saving=true;f.post("php/finitureTabelle.php?type=update",{id:b.finituraTabella.i,nome:b.finituraTabella.n,line:b.finituraTabella.l,mark:b.finituraTabella.m}).success(function(h){b.vm.saveFinitureTabelleData();_.each(b.vm.finitureTabelle,function(i){if(i.i==b.finituraTabella.i){i.n=b.finituraTabella.n;i.m=b.finituraTabella.m;i.l=b.finituraTabella.l;b.finituraTabella=angular.copy(i)}});a.saving=false;b.errore.finituraTabella=false}).error(function(i,h){console.log(h)})}else{b.errore.finituraTabella=true}}if(g=="C"){if(!e()){a.saving=true;f.post("php/finitureTabelle.php?type=new",{id:b.vm.nuovaFinituraTabella.i,nome:b.finituraTabella.n,line:b.finituraTabella.l,mark:b.finituraTabella.m}).success(function(h){b.vm.copiedFinituraTabella={i:b.vm.nuovaFinituraTabella.i,n:b.finituraTabella.n,l:b.finituraTabella.l,m:b.finituraTabella.m};b.vm.finitureTabelle.push(b.vm.copiedFinituraTabella);b.vm.nuovaFinituraTabella={i:b.vm.nuovaFinituraTabella.i+1};b.vm.saveFinitureTabelleData();a.saving=false;b.errore.finituraTabella=false}).error(function(i,h){console.log(h)})}else{b.errore.finituraTabella=true}}if(g=="D"){a.saving=true;f.post("php/finitureTabelle.php?type=delete",{id:b.finituraTabella.i,nome:b.finituraTabella.n,line:b.finituraTabella.l,mark:b.finituraTabella.m}).success(function(h){b.vm.finitureTabelle=_.filter(b.vm.finitureTabelle,function(i){return i.i!=b.finituraTabella.i});b.vm.saveFinitureTabelleData();b.newFinituraTabella()}).error(function(i,h){console.log(h)})}}}}});angular.module("mpuDashboard").directive("abbinamenti",function(){return{restrict:"E",templateUrl:"template/abbinamenti.html",scope:{abbinamentoOriginal:"=",vm:"="},controller:function(b,g,d,a){b.$watch("abbinamentoOriginal",function(h){b.abbinamento=angular.copy(h.abbinamento)});b.errore={abbinamento:false};b.addAbbinamento=function(){b.abbinamento.f.push({i:false,n:""})};b.removeAbbinamento=function(h){b.abbinamento.f.splice(h,1)};b.confirm=false;b.askConfirm=function(){b.confirm=true;d(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.abbinamento.c||!b.abbinamento.u)};b.copyCheck=function(){return(!b.abbinamento.c||!b.abbinamento.m||!b.abbinamento.l||(b.abbinamento.c===b.abbinamentoOriginal.abbinamento.c&&b.abbinamento.m===b.abbinamentoOriginal.abbinamento.m&&b.abbinamento.l===b.abbinamentoOriginal.abbinamento.l))};b.newAbbinamento=function(){a.saving=false;b.errore.abbinamento=false;b.abbinamentoOriginal.selected=false;b.vm.nuovoAbbinamento={i:b.vm.nuovoAbbinamento.i+1,m:false,l:false,u:false,f:[{i:false,n:""}]}};function c(){if(b.abbinamento.c!=b.abbinamentoOriginal.abbinamento.c||b.abbinamento.m!=b.abbinamentoOriginal.abbinamento.m||b.abbinamento.l!=b.abbinamentoOriginal.abbinamento.l){return _.findWhere(b.vm.abbinamenti,{n:b.abbinamento.c,m:b.abbinamento.m,l:b.abbinamento.l})}else{return false}}function e(){return _.findWhere(b.vm.abbinamenti,{c:b.abbinamento.c,m:b.abbinamento.m,l:b.abbinamento.l,u:b.abbinamento.u})}function f(){var h=_.filter(b.abbinamento.f,function(i){return !i.i||!i.n});return h.length}b.action=function(h){if(h=="U"){if(!c()&&f()===0){a.saving=true;g.post("php/abbinamenti.php?type=update",{id:b.abbinamento.i,cod:b.abbinamento.c,line:b.abbinamento.l,mark:b.abbinamento.m,abb_array:b.abbinamento.f,tab:b.abbinamento.u}).success(function(i){b.vm.saveAbbinamentiData();_.each(b.vm.abbinamenti,function(j){if(j.i==b.abbinamento.i){j.c=b.abbinamento.c;j.l=b.abbinamento.l;j.m=b.abbinamento.m;j.f=b.abbinamento.f;j.u=b.abbinamento.u;b.abbinamento=angular.copy(j)}});a.saving=false;b.errore.abbinamento=false}).error(function(j,i){console.log(i)})}else{b.errore.abbinamento=true}}if(h=="C"){if(!e()){a.saving=true;g.post("php/abbinamenti.php?type=new",{id:b.vm.nuovoAbbinamento.i,cod:b.abbinamento.c,line:b.abbinamento.l,mark:b.abbinamento.m,abb_array:b.abbinamento.f,tab:b.abbinamento.u}).success(function(j){var i={i:b.vm.nuovoAbbinamento.i,c:b.abbinamento.c,l:b.abbinamento.l,m:b.abbinamento.m,f:b.abbinamento.f,u:b.abbinamento.u};b.vm.copiedAbbinamento=angular.copy(i);b.vm.abbinamenti.push(b.vm.copiedAbbinamento);b.vm.nuovoAbbinamento={i:b.vm.nuovoAbbinamento.i+1};b.vm.saveAbbinamentiData();a.saving=false;b.errore.abbinamento=false}).error(function(j,i){console.log(i)})}else{b.errore.abbinamento=true}}if(h=="D"){a.saving=true;g.post("php/abbinamenti.php?type=delete",{id:b.abbinamento.i,cod:b.abbinamento.c,line:b.abbinamento.l,mark:b.abbinamento.m,abb_array:b.abbinamento.f,tab:b.abbinamento.u}).success(function(i){b.vm.abbinamenti=_.filter(b.vm.abbinamenti,function(j){return j.i!=b.abbinamento.i});b.vm.saveAbbinamentiData();b.newAbbinamento()}).error(function(j,i){console.log(i)})}}}}});angular.module("mpuDashboard").directive("lineeSettori",function(){return{restrict:"E",templateUrl:"template/lineeSettori.html",scope:{lineaSettoreOriginal:"=",vm:"="},controller:function(j,g,c,h){j.errore={lineaSettore:false};function d(k){_.each(j.vm.marchi,function(l){if(l.i==k){markByName=l.n}});return markByName}function b(k){_.each(j.vm.linee,function(l){if(l.i==k){lineByName=l.n}});return lineByName}function e(k){_.each(j.vm.settori,function(l){if(l.i==k){setByName=l.n}});return setByName}function f(k,m,l){return k.replace(new RegExp(m,"g"),l)}j.$watch("lineaSettoreOriginal",function(k){j.lineaSettore=angular.copy(k.lineaSettore);var l=d(j.lineaSettore.m);var m=b(j.lineaSettore.l);var n=e(j.lineaSettore.h);l=f(l," ","_");m=f(m," ","_");n=f(n," ","_");var o=m+"_"+n+".jpg";j.lineaSettore.r="../dashboard/archivio_dati/"+l+"/"+m+"/Vetrina/"+o});j.confirm=false;j.askConfirm=function(){j.confirm=true;c(function(){j.confirm=false},4000)};j.toggleSet=function(k){if(j.lineaSettore.q.indexOf(k)==-1){j.lineaSettore.q.push(parseInt(k))}else{j.lineaSettore.q.splice(j.lineaSettore.q.indexOf(k),1)}};j.checkList=function(k){return(j.lineaSettore.q.indexOf(k)!=-1)};var a=function(){return(j.lineaSettore.q.length)};j.updateCheck=function(){return(!j.lineaSettore.m||!j.lineaSettore.l||!j.lineaSettore.h)};j.deleteCheck=function(){return(j.lineaSettore.m!==j.lineaSettoreOriginal.lineaSettore.m||j.lineaSettore.l!==j.lineaSettoreOriginal.lineaSettore.l||j.lineaSettore.h!==j.lineaSettoreOriginal.lineaSettore.h)};var i=function(){if(j.lineaSettore.m!=j.lineaSettoreOriginal.lineaSettore.m||j.lineaSettore.l!=j.lineaSettoreOriginal.lineaSettore.l||j.lineaSettore.h!=j.lineaSettoreOriginal.lineaSettore.h){return _.findWhere(j.vm.lineeSettori,{m:j.lineaSettore.m,l:j.lineaSettore.l,h:j.lineaSettore.h})}else{return false}};j.newItem=function(){h.saving=false;j.lineaSettoreOriginal.selected=false;j.vm.nuovaLineaSettore={i:j.vm.nuovaLineaSettore.i+1,v:1,p:0,z:1,q:[],m:false,r:false};j.errore.lineaSettore=false};j.action=function(k){if(k=="U"){if(!i()&&a()!=0){h.saving=true;g.post("php/lineeSettori.php?type=update",{id:j.lineaSettore.i,mark:j.lineaSettore.m,line:j.lineaSettore.l,set:j.lineaSettore.h,show:j.lineaSettore.v,price:j.lineaSettore.z,man:j.lineaSettore.q,image:j.lineaSettore.r,sourceMark:j.lineaSettoreOriginal.lineaSettore.m,sourceLine:j.lineaSettoreOriginal.lineaSettore.l,sourceSet:j.lineaSettoreOriginal.lineaSettore.h}).success(function(l){j.errore.lineaSettore=false;j.vm.saveLineaSettoreData();console.log("Risposta dalla pagina PHP",l);_.each(j.vm.lineeSettori,function(m){if(m.i==j.lineaSettore.i){m.m=j.lineaSettore.m;m.l=j.lineaSettore.l;m.h=j.lineaSettore.h;m.r=j.lineaSettore.r;m.z=j.lineaSettore.z;m.q=j.lineaSettore.q;m.v=j.lineaSettore.v;j.lineaSettore=angular.copy(m)}});h.saving=false}).error(function(m,l){console.log(l)})}else{j.errore.lineaSettore=true}}if(k=="D"){h.saving=true;g.post("php/lineeSettori.php?type=delete",{id:j.lineaSettore.i,mark:j.lineaSettore.m,line:j.lineaSettore.l,set:j.lineaSettore.h,show:j.lineaSettore.v,price:j.lineaSettore.z,man:j.lineaSettore.q,image:j.lineaSettore.r}).success(function(l){j.vm.lineeSettori=_.filter(j.vm.lineeSettori,function(m){return m.i!=j.lineaSettore.i});j.vm.saveLineaSettoreData();j.newItem()}).error(function(m,l){console.log(l)})}}}}});angular.module("mpuDashboard").directive("prodotti",function(){return{restrict:"E",templateUrl:"template/prodotti.html",scope:{prodottoOriginal:"=",vm:"="},controller:function(j,h,b,i){j.errore={prodotto:false};j.addProdotto=function(){j.prodotto.z.push({z:"",a:""})};j.removeProdotto=function(k){j.prodotto.z.splice(k,1)};function e(k){_.each(j.vm.marchi,function(l){if(l.i==k){markByName=l.n}});return markByName}function a(k){_.each(j.vm.linee,function(l){if(l.i==k){lineByName=l.n}});return lineByName}function g(k,m,l){return k.replace(new RegExp(m,"g"),l)}j.$watch("prodottoOriginal",function(k){j.prodotto=angular.copy(k.prodotto);var l=e(j.prodotto.m);var m=a(j.prodotto.l);l=g(l," ","_");m=g(m," ","_");var n=j.prodotto.c+".jpg";j.prodotto.r="../dashboard/archivio_dati/"+l+"/"+m+"/Prodotti/"+n});j.confirm=false;j.confirmAll=false;j.askConfirm=function(k){if(!k){j.confirm=true;b(function(){j.confirm=false},4000)}else{j.confirmAll=true;b(function(){j.confirmAll=false},4000)}};j.updateCheck=function(){return(!j.prodotto.c||!j.prodotto.n||!j.prodotto.m||!j.prodotto.l||!j.prodotto.x||!j.prodotto.t||!j.prodotto.r)};j.deleteCheck=function(){return(j.prodotto.c!==j.prodottoOriginal.prodotto.c||j.prodotto.m!==j.prodottoOriginal.prodotto.m||j.prodotto.l!==j.prodottoOriginal.prodotto.l)};j.copyCheck=function(){return(!j.prodotto.c||!j.prodotto.m||!j.prodotto.l||j.prodotto.c===j.prodottoOriginal.prodotto.c)};var d=function(){if(j.prodotto.c!=j.prodottoOriginal.prodotto.c||j.prodotto.l!=j.prodottoOriginal.prodotto.l){return _.findWhere(j.vm.prodotti,{c:j.prodotto.c,l:j.prodotto.l})}else{return false}};var f=function(){return _.findWhere(j.vm.prodotti,{c:j.prodotto.c,m:j.prodotto.m,l:j.prodotto.l})};var c=function(){var k=_.filter(j.prodotto.z,function(l){return isNaN(l.z)||!l.z||!l.a});return k.length};j.newProdotto=function(){i.saving=false;j.errore.prodotto=false;j.prodottoOriginal.selected=false;j.vm.nuovoProdotto={i:j.vm.nuovoProdotto.i+1,m:false,l:false,t:false,a:"",y:1,f:0,z:[{z:"",a:""}]}};j.action=function(k){if(k==="U"){if(!d()&&c()===0){i.saving=true;h.post("php/prodotti.php?type=update",{id:j.prodotto.i,mark:j.prodotto.m,line:j.prodotto.l,cod:j.prodotto.c,title:j.prodotto.n,tbpr:j.prodotto.t,dim:j.prodotto.d,pos:j.prodotto.y,lnfn:j.prodotto.x,note:j.prodotto.o,abb:j.prodotto.a,fin:j.prodotto.f,prices:j.prodotto.z,image:j.prodotto.r,sourceCod:j.prodottoOriginal.prodotto.c,sourceMark:j.prodottoOriginal.prodotto.m,sourceLine:j.prodottoOriginal.prodotto.l}).success(function(l){j.errore.prodotto=false;j.vm.saveProdottoData();console.log("Risposta dalla pagina PHP",l);_.each(j.vm.prodotti,function(m){if(m.i==j.prodotto.i){m.m=j.prodotto.m;m.l=j.prodotto.l;m.c=j.prodotto.c;m.n=j.prodotto.n;m.t=j.prodotto.t;m.d=j.prodotto.d;m.y=j.prodotto.y;m.x=j.prodotto.x;m.o=j.prodotto.o;m.a=j.prodotto.a;m.f=j.prodotto.f;m.z=j.prodotto.z;m.r=j.prodotto.r;j.prodotto=angular.copy(m)}});i.saving=false;j.errore.prodotto=false}).error(function(m,l){console.log(l)})}else{j.errore.prodotto=true}}if(k==="C"){if(!f()&&c()===0){i.saving=true;h.post("php/prodotti.php?type=new",{id:j.vm.nuovoProdotto.i,mark:j.prodotto.m,line:j.prodotto.l,cod:j.prodotto.c,title:j.prodotto.n,tbpr:j.prodotto.t,dim:j.prodotto.d,pos:j.prodotto.y,lnfn:j.prodotto.x,note:j.prodotto.o,abb:j.prodotto.a,fin:j.prodotto.f,prices:j.prodotto.z,image:j.prodotto.r,sourceCod:j.prodottoOriginal.prodotto.c,sourceMark:j.prodottoOriginal.prodotto.m,sourceLine:j.prodottoOriginal.prodotto.l}).success(function(m){console.log("Risposta dalla pagina PHP",m);var l={i:j.vm.nuovoProdotto.i,m:j.prodotto.m,l:j.prodotto.l,c:j.prodotto.c,n:j.prodotto.n,t:j.prodotto.t,d:j.prodotto.d,y:j.prodotto.y,x:j.prodotto.x,o:j.prodotto.o,a:j.prodotto.a,f:j.prodotto.f,z:j.prodotto.z};j.vm.prodotti.push(angular.copy(l));j.vm.nuovoProdotto={i:j.vm.nuovoProdotto.i+1};j.vm.saveProdottoData();i.saving=false;j.errore.prodotto=false}).error(function(m,l){console.log(l)})}else{j.errore.prodotto=true}}if(k==="D"){i.saving=true;h.post("php/prodotti.php?type=delete",{id:j.prodotto.i,mark:j.prodotto.m,line:j.prodotto.l,cod:j.prodotto.c,title:j.prodotto.n,tbpr:j.prodotto.t,dim:j.prodotto.d,pos:j.prodotto.y,lnfn:j.prodotto.x,note:j.prodotto.o,abb:j.prodotto.a,fin:j.prodotto.f,prices:j.prodotto.z,image:j.prodotto.r}).success(function(l){console.log("Risposta dalla pagina PHP",l);j.vm.prodotti=_.filter(j.vm.prodotti,function(m){return m.i!=j.prodotto.i});j.vm.saveProdottoData();j.newProdotto()}).error(function(m,l){console.log(l)})}if(k==="A"){i.saving=true;h.post("php/prodotti.php?type=deleteAll",{mark:j.prodotto.m,line:j.prodotto.l}).success(function(l){console.log("Risposta dalla pagina PHP",l);j.vm.prodotti=_.filter(j.vm.prodotti,function(m){return m.i!=j.prodotto.i});j.vm.saveProdottoData();j.newProdotto()}).error(function(m,l){console.log(l)})}}}}});angular.module("mpuDashboard").directive("prodottiSettori",function(){return{restrict:"E",templateUrl:"template/prodottiSettori.html",scope:{prodottoSettoreOriginal:"=",vm:"="},controller:function(c,f,d,b,a){c.$watch("prodottoSettoreOriginal",function(g){c.prodottoSettore=angular.copy(g.prodottoSettore)});c.saveDataDB=function(){b.saving=true;f.post("php/prodottiSettori.php?type=db").success(function(){b.saving=false;a.prodottiSettori().then(function(g){c.vm.prodottiSettori=g})}).error(function(h,g){console.log(g)})};c.errore={prodottoSettore:false};c.confirm=false;c.askConfirm=function(){c.confirm=true;d(function(){c.confirm=false},4000)};c.$watch("prodottoSettore",function(h){c.prodottiAvailable=[{c:" Tutti",i:-1},{c:c.prodottoSettore.n,i:c.prodottoSettore.c}];var g=_.where(c.vm.prodotti,{l:h.l});_.each(g,function(i){if(!_.find(c.vm.prodottiSettori,function(j){return j.c===i.i})){c.prodottiAvailable.push(i)}})});c.$watch("prodottoSettore.w",function(g){c.settoriAvailable=_.where(c.vm.lineeSettori,{l:g});_.each(c.settoriAvailable,function(h){h.n=_.findWhere(c.vm.settori,{i:h.h}).n})});c.$watch("prodottoSettore.c",function(g){if(g&&g!=-1){var h=_.find(c.vm.prodotti,function(i){return i.i==g});c.prodottoSettore.n=h.c}});c.selectedCat=function(g){return(c.prodottoSettore.h.indexOf(g)!=-1)};c.toggleSet=function(g){if(c.prodottoSettore.h.indexOf(g)==-1){c.prodottoSettore.h.push(parseInt(g))}else{c.prodottoSettore.h.splice(c.prodottoSettore.h.indexOf(g),1)}};c.updateCheck=function(){return(c.prodottoSettore.c==-1)};c.enableUpdate=false;c.$watchCollection("prodottoSettore.h",function(g){if(c.prodottoSettore.i==c.prodottoSettoreOriginal.prodottoSettore.i&&g!=c.prodottoSettoreOriginal.h){c.enableUpdate=true}});c.copyCheck=function(){return(c.prodottoSettore.c===-1||c.prodottoSettore.c===c.prodottoSettoreOriginal.prodottoSettore.c)};function e(){return c.prodottoSettore.h.length}c.newProdottoSettore=function(){b.saving=false;c.errore.prodottoSettore=false;c.prodottoSettoreOriginal.selected=false;c.vm.nuovoProdottoSettore={i:c.vm.nuovoProdottoSettore.i+1,m:false,l:false,c:false,h:[]}};c.action=function(g){if(g=="U"){if(e()!=0){b.saving=true;f.post("php/prodottiSettori.php?type=update",{id:c.prodottoSettore.i,cod:c.prodottoSettore.c,mark:c.prodottoSettore.m,line:c.prodottoSettore.l,nwln:c.prodottoSettore.w,array:c.prodottoSettore.h}).success(function(h){_.each(c.vm.prodottiSettori,function(j,i){if(j.i==c.prodottoSettore.i){j.c=c.prodottoSettore.c;j.n=c.prodottoSettore.n;j.m=c.prodottoSettore.m;j.l=c.prodottoSettore.l;j.w=c.prodottoSettore.w;j.h=c.prodottoSettore.h;c.prodottoSettore=angular.copy(j)}});b.saving=false;c.errore.prodottoSettore=false;c.vm.saveProdottoSettoreData()}).error(function(i,h){console.log(h)})}else{c.errore.prodottoSettore=true}}if(g=="C"){if(e()!=0){b.saving=true;f.post("php/prodottiSettori.php?type=new",{id:c.vm.nuovoProdottoSettore.i,cod:c.prodottoSettore.c,mark:c.prodottoSettore.m,line:c.prodottoSettore.l,nwln:c.prodottoSettore.w,array:c.prodottoSettore.h}).success(function(h){c.vm.copiedProdottoSettore={i:c.vm.nuovoProdottoSettore.i,c:c.prodottoSettore.c,n:c.prodottoSettore.n,m:c.prodottoSettore.m,l:c.prodottoSettore.l,w:c.prodottoSettore.w,h:c.prodottoSettore.h};c.vm.prodottiSettori.push(c.vm.copiedProdottoSettore);c.vm.nuovoProdottoSettore={i:c.vm.nuovoProdottoSettore.i+1};c.vm.saveProdottoSettoreData();b.saving=false;c.errore.prodottoSettore=false}).error(function(i,h){console.log(h)})}else{c.errore.prodottoSettore=true}}if(g=="D"){b.saving=true;f.post("php/prodottiSettori.php?type=delete",{id:c.prodottoSettore.i,cod:c.prodottoSettore.c,mark:c.prodottoSettore.m,line:c.prodottoSettore.l,nwln:c.prodottoSettore.w,array:c.prodottoSettore.h}).success(function(h){if(c.prodottoSettore.c!=-1){c.vm.prodottiSettori=_.filter(c.vm.prodottiSettori,function(i){return i.i!=c.prodottoSettore.i});c.vm.saveProdottoSettoreData()}else{c.saveDataDB()}c.newProdottoSettore()}).error(function(i,h){console.log(h)})}}}}});angular.module("mpuDashboard").directive("vetrine",function(){return{restrict:"E",templateUrl:"template/vetrine.html",scope:{vetrinaOriginal:"=",vm:"="},controller:function(i,f,b,h){i.errore={vetrina:false};function c(j){_.each(i.vm.marchi,function(k){if(k.i==j){markByName=k.n}});return markByName}function a(j){_.each(i.vm.linee,function(k){if(k.i==j){lineByName=k.n}});return lineByName}function e(j,l,k){return j.replace(new RegExp(l,"g"),k)}i.$watch("vetrinaOriginal",function(j){i.vetrina=angular.copy(j.vetrina);var k=c(i.vetrina.m);var l=a(i.vetrina.l);k=e(k," ","_");l=e(l," ","_");var m=l+"_"+i.vetrina.c+".jpg";i.vetrina.r="../dashboard/archivio_dati/"+k+"/"+l+"/Vetrina/"+m});i.confirm=false;i.askConfirm=function(){i.confirm=true;b(function(){i.confirm=false},4000)};i.updateCheck=function(){return(!i.vetrina.c||!i.vetrina.n||!i.vetrina.m||!i.vetrina.l||!i.vetrina.r||isNaN(i.vetrina.y))};i.deleteCheck=function(){return(i.vetrina.c!==i.vetrinaOriginal.vetrina.c||i.vetrina.m!==i.vetrinaOriginal.vetrina.m||i.vetrina.l!==i.vetrinaOriginal.vetrina.l)};i.copyCheck=function(){return(!i.vetrina.c||!i.vetrina.m||!i.vetrina.l||(i.vetrina.c===i.vetrinaOriginal.vetrina.c&&i.vetrina.l===i.vetrinaOriginal.vetrina.l))};var g=function(){if(i.vetrina.c!=i.vetrinaOriginal.vetrina.c||i.vetrina.l!=i.vetrinaOriginal.vetrina.l){return _.findWhere(i.vm.vetrine,{c:i.vetrina.c,l:i.vetrina.l})}else{return false}};var d=function(){return _.findWhere(i.vm.vetrine,{c:i.vetrina.c,m:i.vetrina.m,l:i.vetrina.l})};i.newVetrina=function(){h.saving=false;i.errore.vetrina=false;i.vetrinaOriginal.selected=false;i.vm.nuovaVetrina={i:i.vm.nuovaVetrina.i+1,m:false,l:false,y:1,v:1}};i.action=function(j){if(j=="U"){if(!g()){h.saving=true;f.post("php/vetrine.php?type=update",{id:i.vetrina.i,mark:i.vetrina.m,line:i.vetrina.l,cod:i.vetrina.c,title:i.vetrina.n,show:i.vetrina.v,pos:i.vetrina.y,note:i.vetrina.o,image:i.vetrina.r,sourceCod:i.vetrinaOriginal.vetrina.c,sourceMark:i.vetrinaOriginal.vetrina.m,sourceLine:i.vetrinaOriginal.vetrina.l}).success(function(k){i.errore.vetrina=false;i.vm.saveVetrinaData();console.log("Risposta dalla pagina PHP",k);_.each(i.vm.vetrine,function(l){if(l.i==i.vetrina.i){l.m=i.vetrina.m;l.l=i.vetrina.l;l.c=i.vetrina.c;l.n=i.vetrina.n;l.v=i.vetrina.v;l.y=i.vetrina.y;l.o=i.vetrina.o;l.r=i.vetrina.r;i.vetrina=angular.copy(l)}});h.saving=false;i.errore.vetrina=false}).error(function(l,k){console.log(k)})}else{i.errore.vetrina=true}}if(j=="C"){if(!d()){h.saving=true;f.post("php/vetrine.php?type=new",{id:i.vm.nuovaVetrina.i,mark:i.vetrina.m,line:i.vetrina.l,cod:i.vetrina.c,title:i.vetrina.n,show:i.vetrina.v,pos:i.vetrina.y,note:i.vetrina.o,image:i.vetrina.r,sourceCod:i.vetrinaOriginal.vetrina.c,sourceMark:i.vetrinaOriginal.vetrina.m,sourceLine:i.vetrinaOriginal.vetrina.l}).success(function(k){console.log("Risposta dalla pagina PHP",k);i.vm.copiedVetrina={i:i.vm.nuovoProdotto.i,m:i.vetrina.m,l:i.vetrina.l,c:i.vetrina.c,n:i.vetrina.n,v:i.vetrina.v,y:i.vetrina.y,o:i.vetrina.o};i.vm.vetrine.push(i.vm.copiedVetrina);i.vm.nuovaVetrina={i:i.vm.nuovaVetrina.i+1};i.vm.saveVetrinaData();h.saving=false;i.errore.vetrina=false}).error(function(l,k){console.log(k)})}else{i.errore.vetrina=true}}if(j=="D"){h.saving=true;f.post("php/vetrine.php?type=delete",{id:i.vetrina.i,mark:i.vetrina.m,line:i.vetrina.l,cod:i.vetrina.c,title:i.vetrina.n,show:i.vetrina.v,pos:i.vetrina.y,note:i.vetrina.o,image:i.vetrina.r}).success(function(k){i.vm.vetrine=_.filter(i.vm.vetrine,function(l){return l.i!=i.vetrina.i});i.vm.saveVetrinaData();i.newVetrina()}).error(function(l,k){console.log(k)})}}}}});angular.module("mpuDashboard").directive("vetrineProdotti",function(){return{restrict:"E",templateUrl:"template/vetrineProdotti.html",scope:{vetrinaProdottoOriginal:"=",vm:"="},controller:function(b,d,c,a){b.$watch("vetrinaProdottoOriginal",function(e){b.vetrinaProdotto=angular.copy(e.vetrinaProdotto)});b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.$watch("vetrinaProdotto.p",function(g,f){if(g!=f&&b.vetrinaProdottoOriginal.i==b.vetrinaProdotto){b.vetrinaProdotto.u=false}if(g){var k=_.findWhere(b.vm.prodotti,{i:g});var e=_.pluck(k.z,"a");b.tabsAvailable=[];for(var h=0;h<e.length;h++){var j=_.findWhere(b.vm.finitureTabelle,{i:e[h]});b.tabsAvailable.push({i:e[h],n:j.n})}return b.tabsAvailable}});b.$watch("vetrinaProdotto.u",function(f,e){if(f!=e&&b.vetrinaProdottoOriginal.i==b.vetrinaProdotto){b.vetrinaProdotto.f=false}if(f){b.finsAvailable=_.where(b.vm.abbinamenti,{u:f});return b.finsAvailable}});b.newVetrinaProdotto=function(){a.saving=false;b.vetrinaProdotto={i:b.vm.nuovoVetrinaProdotto.i+1,c:false,p:false,m:false,k:false,l:false,j:false,u:false,f:false,y:1,q:1}};b.updateCheck=function(){return(!b.vetrinaProdotto.c||!b.vetrinaProdotto.p||!b.vetrinaProdotto.l||!b.vetrinaProdotto.j||!b.vetrinaProdotto.u||!b.vetrinaProdotto.f||isNaN(b.vetrinaProdotto.y)||isNaN(b.vetrinaProdotto.q))};b.action=function(e){if(e=="U"){a.saving=true;d.post("php/vetrineProdotti.php?type=update",{id:b.vetrinaProdotto.i,comp:b.vetrinaProdotto.c,prd:b.vetrinaProdotto.p,pline:b.vetrinaProdotto.l,cline:b.vetrinaProdotto.j,pmark:b.vetrinaProdotto.m,cmark:b.vetrinaProdotto.k,fin:b.vetrinaProdotto.f,tab:b.vetrinaProdotto.u,pos:b.vetrinaProdotto.y,qnt:b.vetrinaProdotto.q}).success(function(f){b.vm.saveVetrineProdottiData();console.log("Risposta dalla pagina PHP",f);_.each(b.vm.vetrineProdotti,function(g){if(g.i==b.vetrinaProdotto.i){g.c=b.vetrinaProdotto.c;g.p=b.vetrinaProdotto.p;g.l=b.vetrinaProdotto.l;g.j=b.vetrinaProdotto.j;g.m=b.vetrinaProdotto.m;g.k=b.vetrinaProdotto.k;g.f=b.vetrinaProdotto.f;g.u=b.vetrinaProdotto.u;g.y=b.vetrinaProdotto.y;g.q=b.vetrinaProdotto.q;b.vetrinaProdotto=angular.copy(g)}});a.saving=false}).error(function(g,f){console.log(f)})}if(e=="C"){a.saving=true;d.post("php/vetrineProdotti.php?type=new",{id:b.vm.nuovoVetrinaProdotto.i,comp:b.vetrinaProdotto.c,prd:b.vetrinaProdotto.p,pline:b.vetrinaProdotto.l,cline:b.vetrinaProdotto.j,pmark:b.vetrinaProdotto.m,cmark:b.vetrinaProdotto.k,fin:b.vetrinaProdotto.f,tab:b.vetrinaProdotto.u,pos:b.vetrinaProdotto.y,qnt:b.vetrinaProdotto.q}).success(function(f){console.log("Risposta dalla pagina PHP",f);b.vm.copiedVetrinaProdotto={i:b.vm.nuovoVetrinaProdotto.i,c:b.vetrinaProdotto.c,p:b.vetrinaProdotto.p,l:b.vetrinaProdotto.l,j:b.vetrinaProdotto.j,m:b.vetrinaProdotto.m,k:b.vetrinaProdotto.k,f:b.vetrinaProdotto.f,u:b.vetrinaProdotto.u,y:b.vetrinaProdotto.y,q:b.vetrinaProdotto.q};b.vm.vetrineProdotti.push(b.vm.copiedVetrinaProdotto);b.vm.nuovoVetrinaProdotto={i:b.vm.nuovoVetrinaProdotto.i+1};b.vm.saveVetrineProdottiData();a.saving=false}).error(function(g,f){console.log(f)})}if(e=="D"){a.saving=true;d.post("php/vetrineProdotti.php?type=delete",{id:b.vetrinaProdotto.i,comp:b.vetrinaProdotto.c,prd:b.vetrinaProdotto.p,pline:b.vetrinaProdotto.l,cline:b.vetrinaProdotto.j,pmark:b.vetrinaProdotto.m,cmark:b.vetrinaProdotto.k,fin:b.vetrinaProdotto.f,tab:b.vetrinaProdotto.u,pos:b.vetrinaProdotto.y,qnt:b.vetrinaProdotto.q}).success(function(f){b.vm.vetrineProdotti=_.filter(b.vm.vetrineProdotti,function(g){return g.i!=b.vetrinaProdotto.i});b.vm.saveVetrineProdottiData();b.newVetrinaProdotto()}).error(function(g,f){console.log(f)})}}}}});angular.module("mpuDashboard").directive("nazioni",function(){return{restrict:"E",templateUrl:"template/nazioni.html",scope:{cat:"=",vm:"="},controller:function(b,d,c,a){b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.cat.n||!b.cat.x)};b.action=function(e){if(e=="U"){a.saving=true;d.post("php/nazioni.php?type=update",{id:b.cat.i,nome:b.cat.n,show:b.cat.v,prx:b.cat.x}).success(function(f){b.vm.saveNazioniData();a.saving=false}).error(function(g,f){console.log(f)})}if(e=="D"){a.saving=true;d.post("php/nazioni.php?type=delete",{id:b.cat.i,nome:b.cat.n,show:b.cat.v,prx:b.cat.x}).success(function(f){b.vm.nazioni=_.filter(b.vm.nazioni,function(g){return g.i!=b.cat.i});b.vm.saveNazioniData();a.saving=false}).error(function(g,f){console.log(f)})}}}}});angular.module("mpuDashboard").directive("regioni",function(){return{restrict:"E",templateUrl:"template/regioni.html",scope:{regioneOriginal:"=",vm:"="},controller:function(b,e,d,a){b.$watch("regioneOriginal",function(f){b.regione=angular.copy(f.regione)});b.errore={regione:false};b.confirm=false;b.askConfirm=function(){b.confirm=true;d(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.regione.n||!b.regione.z)};b.newItem=function(){b.regioneOriginal.selected=false;b.errore.regione=false;a.saving=false;b.vm.nuovaRegione={i:b.vm.nuovaRegione.i+1,z:false}};var c=function(){return _.findWhere(b.vm.regioni,{n:b.regione.n,z:b.regione.z})};b.action=function(f){if(f=="U"){if(!c()){a.saving=true;e.post("php/regioni.php?type=update",{id:b.regione.i,nome:b.regione.n,nazione:b.regione.z}).success(function(g){b.vm.saveRegioniData();_.each(b.vm.regioni,function(h){if(h.i==b.regione.i){h.n=b.regione.n;h.z=b.regione.z;b.regione=angular.copy(h)}});a.saving=false}).error(function(h,g){console.log(g)})}else{b.errore.regione=true}}if(f=="D"){a.saving=true;e.post("php/regioni.php?type=delete",{id:b.regione.i,nome:b.regione.n,nazioni:b.regione.z}).success(function(g){b.vm.regioni=_.filter(b.vm.regioni,function(h){return h.i!=b.regione.i});b.vm.saveRegioniData();b.newItem()}).error(function(h,g){console.log(g)})}}}}});angular.module("mpuDashboard").directive("province",function(){return{restrict:"E",templateUrl:"template/province.html",scope:{provinciaOriginal:"=",vm:"="},controller:function(b,f,d,a){b.$watch("provinciaOriginal",function(g){b.provincia=angular.copy(g.provincia)});b.errore={provincia:false};b.confirm=false;b.askConfirm=function(){b.confirm=true;d(function(){b.confirm=false},4000)};var e=function(){return(!b.provincia.n||!b.provincia.z)};b.copyCheck=function(){return(!b.provincia.n||!b.provincia.c||!b.provincia.r||!b.provincia.z||b.provincia.n===b.provinciaOriginal.provincia.n)};var c=function(){return _.findWhere(b.vm.province,{n:b.provincia.n,c:b.provincia.c,z:b.provincia.z,r:b.provincia.r})};b.newItem=function(){a.saving=false;b.provinciaOriginal.selected=false;b.errore.provincia=false;b.vm.nuovaProvincia={i:b.vm.nuovaProvincia.i+1,z:false,r:false,b:0,l:0,t:0,j:1,m:0,k:1}};b.action=function(g){if(g=="U"){if(!e()){a.saving=true;f.post("php/province.php?type=update",{id:b.provincia.i,nome:b.provincia.n,sigla:b.provincia.c,nazione:b.provincia.z,regione:b.provincia.r,trasporto:b.provincia.t,trasporto_type:b.provincia.j,montaggio:b.provincia.m,montaggio_type:b.provincia.k,limite:b.provincia.l,minimo:b.provincia.b}).success(function(h){b.vm.saveProvinceData();_.each(b.vm.province,function(i){if(i.i==b.provincia.i){i.n=b.provincia.n;i.c=b.provincia.c;i.z=b.provincia.z;i.r=b.provincia.r;i.t=b.provincia.t;i.j=b.provincia.j;i.m=b.provincia.m;i.k=b.provincia.k;i.l=b.provincia.l;i.b=b.provincia.b;b.provincia=angular.copy(i)}});a.saving=false}).error(function(i,h){console.log(h)})}else{b.errore.provincia=true}}if(g=="C"){if(!c()){a.saving=true;f.post("php/province.php?type=new",{id:b.vm.nuovaProvincia.i+1,nome:b.provincia.n,sigla:b.provincia.c,nazione:b.provincia.z,regione:b.provincia.r,trasporto:b.provincia.t,trasporto_type:b.provincia.j,montaggio:b.provincia.m,montaggio_type:b.provincia.k,limite:b.provincia.l,minimo:b.provincia.b}).success(function(h){b.vm.copiedProvincia={i:b.vm.nuovaProvincia.i,n:b.provincia.n,c:b.provincia.c,z:b.provincia.z,r:b.provincia.r,t:b.provincia.t,j:b.provincia.j,m:b.provincia.m,k:b.provincia.k,l:b.provincia.l,b:b.provincia.b};b.vm.province.push(b.vm.copiedProvincia);b.vm.nuovaProvincia={i:b.vm.nuovaProvincia.i+1};b.vm.saveProvinceData();a.saving=false;b.errore.provincia=false}).error(function(i,h){console.log(h)})}else{b.errore.provincia=true}}if(g=="D"){a.saving=true;f.post("php/province.php?type=delete",{id:b.provincia.i,nome:b.provincia.n,sigla:b.provincia.c,nazione:b.provincia.z,regione:b.provincia.r,trasporto:b.provincia.t,trasporto_type:b.provincia.j,montaggio:b.provincia.m,montaggio_type:b.provincia.k,limite:b.provincia.l,minimo:b.provincia.b}).success(function(h){b.vm.province=_.filter(b.vm.province,function(i){return i.i!=b.provincia.i});b.vm.saveProvinceData();b.newItem()}).error(function(i,h){console.log(h)})}}}}});angular.module("mpuDashboard").directive("convenzioni",function(){return{restrict:"E",templateUrl:"template/convenzioni.html",scope:{cat:"=",vm:"="},controller:function(b,d,c,a){b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.cat.n)};b.action=function(e){if(e=="U"){a.saving=true;d.post("php/convenzioni.php?type=update",{id:b.cat.i,nome:b.cat.n,email:b.cat.e}).success(function(f){b.vm.saveConvenzioniData();a.saving=false}).error(function(g,f){console.log(f)})}if(e=="D"){a.saving=true;d.post("php/convenzioni.php?type=delete",{id:b.cat.i,nome:b.cat.n,email:b.cat.e}).success(function(f){b.vm.convenzioni=_.filter(b.vm.convenzioni,function(g){return g.i!=b.cat.i});b.vm.saveConvenzioniData();a.saving=false}).error(function(g,f){console.log(f)})}}}}});angular.module("mpuDashboard").directive("agenti",function(){return{restrict:"E",templateUrl:"template/agenti.html",scope:{agenteOriginal:"=",vm:"="},controller:function(b,d,c,a){b.$watch("agenteOriginal",function(e){b.agente=angular.copy(e.agente)});b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.updateCheck=function(){return(!b.agente.n||!b.agente.e||!b.agente.p||!b.agente.r||!b.agente.t)};b.newItem=function(){a.saving=false;b.agenteOriginal.selected=false;b.vm.nuovoAgente={i:b.vm.nuovoAgente.i+1,r:false}};b.convert=function(e,j,h){var k=[];var g="";if(typeof e==="object"){for(var f=0;f<e.length;f++){_.each(b.vm[j],function(i){if(i.i==e[f]){k.push(i[h])}})}return k}else{_.each(b.vm[j],function(i){if(i.i==e){g=i[h]}});return g}};b.action=function(e){if(e=="U"){a.saving=true;d.post("php/agenti.php?type=update",{id:b.agente.i,nome:b.agente.n,email:b.agente.e,password:b.agente.p,tel:b.agente.t,riv:b.agente.r}).success(function(f){b.vm.saveAgentiData();_.each(b.vm.agenti,function(g){if(g.i==b.agente.i){g.n=b.agente.n;g.e=b.agente.e;g.p=b.agente.p;g.t=b.agente.t;g.r=b.agente.r;b.agente=angular.copy(g)}});console.log("Risposta dalla pagina PHP",f);a.saving=false}).error(function(g,f){console.log(f)})}if(e=="D"){a.saving=true;d.post("php/agenti.php?type=delete",{id:b.agente.i,nome:b.agente.n,email:b.agente.e,password:b.agente.p,tel:b.agente.t,riv:b.agente.r}).success(function(f){b.vm.agenti=_.filter(b.vm.agenti,function(g){return g.i!=b.agente.i});b.vm.saveAgentiData();b.newItem();a.saving=false}).error(function(g,f){console.log(f)})}}}}});angular.module("mpuDashboard").directive("rivenditori",function(){return{restrict:"E",templateUrl:"template/rivenditori.html",scope:{rivenditoreOriginal:"=",vm:"="},controller:function(b,g,d,a){b.errore={rivenditore:false};b.convert=function(h,m,l){var n=[];var k="";if(typeof h==="object"){for(var j=0;j<h.length;j++){_.each(b.vm[m],function(i){if(i.i==h[j]){n.push(i[l])}})}return n}else{_.each(b.vm[m],function(i){if(i.i==h){k=i[l]}});return k}};b.$watch("rivenditoreOriginal",function(h){b.rivenditore=angular.copy(h.rivenditore);var i=b.rivenditore.i+".jpg";b.rivenditore.g="../dashboard/archivio_dati/Rivenditori/"+i});b.confirm=false;b.askConfirm=function(){b.confirm=true;d(function(){b.confirm=false},4000)};b.updateCheck=function(){return(((!b.rivenditore.z||!b.rivenditore.r||!b.rivenditore.p)&&!b.rivenditore.v)||!b.rivenditore.n||!b.rivenditore.x||!b.rivenditore.s||(!b.rivenditore.h&&!b.rivenditore.c)||!b.rivenditore.e||!b.rivenditore.w||!b.rivenditore.g)};b.copyCheck=function(){if(!b.rivenditore.v){return(!b.rivenditore.z||!b.rivenditore.r||!b.rivenditore.p||!b.rivenditore.n||!b.rivenditore.x||!b.rivenditore.s||(!b.rivenditore.t&&!b.rivenditore.c)||!b.rivenditore.e||!b.rivenditore.w||(b.rivenditore.p===b.rivenditoreOriginal.rivenditore.p))}else{return(!b.rivenditore.n||!b.rivenditore.x||!b.rivenditore.s||(!b.rivenditore.t&&!b.rivenditore.c)||!b.rivenditore.e||!b.rivenditore.w||(b.rivenditore.n===b.rivenditoreOriginal.rivenditore.n))}};var c=function(){if(b.rivenditore.p&&b.rivenditore.p!=b.rivenditoreOriginal.rivenditore.p){return _.findWhere(b.vm.rivenditori,{p:b.rivenditore.p})}else{return false}};var f=function(){if(b.rivenditore.p){return _.findWhere(b.vm.rivenditori,{p:b.rivenditore.p})}};b.openMarchi=function(){b.vm.mv=!b.vm.mv};var e=function(){b.vm.mv=false;b.vm.nuovoRivenditore.y=angular.copy(b.vm.marchi);_.each(b.vm.nuovoRivenditore.y,function(h){h.s=0;delete h.n;delete h.b;delete h.g});return b.vm.nuovoRivenditore.y};e();b.newItem=function(){a.saving=false;b.errore.rivenditore=false;b.rivenditoreOriginal.selected=false;b.vm.nuovoRivenditore={i:b.vm.nuovoRivenditore.i+1,z:false,r:false,p:false,b:0,l:0,t:0,j:1,m:0,k:1,v:false,c:"",h:"",f:"",a:""};e()};b.action=function(h){if(h=="U"){if(!c()){a.saving=true;g.post("php/rivenditori.php?type=update",{id:b.rivenditore.i,nome:b.rivenditore.n,naz:b.rivenditore.z,reg:b.rivenditore.r,prov:b.rivenditore.p,conv:b.rivenditore.v,rif:b.rivenditore.x,sede:b.rivenditore.s,tel:b.rivenditore.h,fax:b.rivenditore.f,cell:b.rivenditore.c,web:b.rivenditore.q,email:b.rivenditore.e,psw:b.rivenditore.w,limite:b.rivenditore.l,minimo:b.rivenditore.b,trasporto:b.rivenditore.t,trasporto_type:b.rivenditore.j,montaggio:b.rivenditore.m,montaggio_type:b.rivenditore.k,mark:b.rivenditore.y,coords:b.rivenditore.o,notes:b.rivenditore.a,image:b.rivenditore.g}).success(function(i){b.errore.rivenditore=false;b.vm.saveRivenditoreData();console.log("Risposta dalla pagina PHP",i);_.each(b.vm.rivenditori,function(j){if(j.i==b.rivenditore.i){j.n=b.rivenditore.n;j.z=b.rivenditore.z;j.r=b.rivenditore.r;j.p=b.rivenditore.p;j.v=b.rivenditore.v;j.r=b.rivenditore.r;j.s=b.rivenditore.s;j.h=b.rivenditore.h;j.f=b.rivenditore.f;j.c=b.rivenditore.c;j.q=b.rivenditore.q;j.e=b.rivenditore.e;j.w=b.rivenditore.w;j.l=b.rivenditore.l;j.b=b.rivenditore.b;j.t=b.rivenditore.t;j.j=b.rivenditore.j;j.m=b.rivenditore.m;j.k=b.rivenditore.k;j.y=b.rivenditore.y;j.o=b.rivenditore.o;j.a=b.rivenditore.a;j.g=b.rivenditore.g;b.rivenditore=angular.copy(j)}});a.saving=false;b.errore.rivenditore=false}).error(function(j,i){console.log(i)})}else{b.errore.rivenditore=true}}if(h=="C"){if(!f()){a.saving=true;g.post("php/rivenditori.php?type=new",{id:b.vm.nuovoRivenditore.i+1,nome:b.rivenditore.n,naz:b.rivenditore.z,reg:b.rivenditore.r,prov:b.rivenditore.p,conv:b.rivenditore.v,rif:b.rivenditore.x,sede:b.rivenditore.s,tel:b.rivenditore.h,fax:b.rivenditore.f,cell:b.rivenditore.c,web:b.rivenditore.q,email:b.rivenditore.e,psw:b.rivenditore.w,limite:b.rivenditore.l,minimo:b.rivenditore.b,trasporto:b.rivenditore.t,trasporto_type:b.rivenditore.j,montaggio:b.rivenditore.m,montaggio_type:b.rivenditore.k,mark:b.rivenditore.y,coords:b.rivenditore.o,notes:b.rivenditore.a,image:b.rivenditore.g,sourceID:b.rivenditoreOriginal.rivenditore.i}).success(function(i){b.vm.copiedRivenditore={i:b.vm.nuovoRivenditore.i+1,n:b.rivenditore.n,z:b.rivenditore.z,r:b.rivenditore.r,p:b.rivenditore.p,v:b.rivenditore.v,x:b.rivenditore.x,s:b.rivenditore.s,h:b.rivenditore.h,f:b.rivenditore.f,c:b.rivenditore.c,q:b.rivenditore.q,e:b.rivenditore.e,w:b.rivenditore.w,l:b.rivenditore.l,b:b.rivenditore.b,t:b.rivenditore.t,j:b.rivenditore.j,m:b.rivenditore.m,k:b.rivenditore.k,y:b.rivenditore.y,o:b.rivenditore.o,a:b.rivenditore.a};b.vm.rivenditori.push(b.vm.copiedRivenditore);b.vm.nuovoRivenditore={i:b.vm.nuovoRivenditore.i+1};b.vm.saveRivenditoreData();a.saving=false;b.errore.rivenditore=false}).error(function(j,i){console.log(i)})}else{b.errore.rivenditore=true}}if(h=="D"){a.saving=true;g.post("php/rivenditori.php?type=delete",{id:b.rivenditore.i,nome:b.rivenditore.n,naz:b.rivenditore.z,reg:b.rivenditore.r,prov:b.rivenditore.p,conv:b.rivenditore.v,rif:b.rivenditore.r,sede:b.rivenditore.s,tel:b.rivenditore.h,fax:b.rivenditore.f,cell:b.rivenditore.c,web:b.rivenditore.q,email:b.rivenditore.e,psw:b.rivenditore.w,limite:b.rivenditore.l,minimo:b.rivenditore.b,trasporto:b.rivenditore.t,trasporto_type:b.rivenditore.j,montaggio:b.rivenditore.m,montaggio_type:b.rivenditore.k,mark:b.rivenditore.y,coords:b.rivenditore.o,notes:b.rivenditore.a,image:b.rivenditore.g}).success(function(i){b.vm.rivenditori=_.filter(b.vm.rivenditori,function(j){return j.i!=b.rivenditore.i});b.vm.saveRivenditoreData();b.newItem()}).error(function(j,i){console.log(i)})}}}}});angular.module("mpuDashboard").directive("esposizioni",function(){return{restrict:"E",templateUrl:"template/esposizioni.html",scope:{esposizioneOriginal:"=",vm:"="},controller:function(i,g,b,h){i.errore={esposizione:false};function d(j){_.each(i.vm.marchi,function(k){if(k.i==j){markByName=k.n}});return markByName}function a(j){_.each(i.vm.linee,function(k){if(k.i==j){lineByName=k.n}});return lineByName}function f(j,l,k){return j.replace(new RegExp(l,"g"),k)}i.$watch("esposizioneOriginal",function(j){i.esposizione=angular.copy(j.esposizione);var k=d(i.esposizione.m);var l=a(i.esposizione.l);k=f(k," ","_");l=f(l," ","_");var m=f(i.esposizione.f," ","_");var n=l+"_"+i.esposizione.c+"_"+m+".jpg";i.esposizione.r="../dashboard/archivio_dati/"+k+"/"+l+"/Render/"+n});i.confirm=false;i.askConfirm=function(){i.confirm=true;b(function(){i.confirm=false},4000)};i.updateCheck=function(){return(!i.esposizione.c||!i.esposizione.f||!i.esposizione.m||!i.esposizione.l||!i.esposizione.t||!i.esposizione.r||isNaN(i.esposizione.y))};i.deleteCheck=function(){return(i.esposizione.c!==i.esposizioneOriginal.esposizione.c||i.esposizione.m!==i.esposizioneOriginal.esposizione.m||i.esposizione.l!==i.esposizioneOriginal.esposizione.l||i.esposizione.f!==i.esposizioneOriginal.esposizione.f)};i.copyCheck=function(){return(!i.esposizione.c||!i.esposizione.m||!i.esposizione.l||!i.esposizione.f||(i.esposizione.c===i.esposizioneOriginal.esposizione.c&&i.esposizione.l===i.esposizioneOriginal.esposizione.l&&i.esposizione.f===i.esposizioneOriginal.esposizione.f))};var c=function(){if(i.esposizione.c!=i.esposizioneOriginal.esposizione.c||i.esposizione.l!=i.esposizioneOriginal.esposizione.l||i.esposizione.f!=i.esposizioneOriginal.esposizione.f){return _.findWhere(i.vm.esposizioni,{c:i.esposizione.c,l:i.esposizione.l,f:i.esposizione.f})}else{return false}};var e=function(){return _.findWhere(i.vm.esposizioni,{c:i.esposizione.c,m:i.esposizione.m,l:i.esposizione.l,f:i.esposizione.f})};i.newItem=function(){h.saving=false;i.errore.esposizione=false;i.esposizioneOriginal.selected=false;i.vm.nuovoComposto={i:i.vm.nuovaEsposizione.i+1,m:false,l:false,t:false,y:1}};i.action=function(j){if(j=="U"){if(!c()){h.saving=true;g.post("php/esposizioni.php?type=update",{id:i.esposizione.i,mark:i.esposizione.m,line:i.esposizione.l,tbpr:i.esposizione.t,cod:i.esposizione.c,fin:i.esposizione.f,dim:i.esposizione.d,pos:i.esposizione.y,nome:i.esposizione.n,image:i.esposizione.r,sourceCod:i.esposizioneOriginal.esposizione.c,sourceMark:i.esposizioneOriginal.esposizione.m,sourceLine:i.esposizioneOriginal.esposizione.l,sourceFin:i.esposizioneOriginal.esposizione.f}).success(function(k){i.errore.esposizione=false;i.vm.saveEsposizioneData();console.log("Risposta dalla pagina PHP",k);_.each(i.vm.esposizioni,function(l){if(l.i==i.esposizione.i){l.m=i.esposizione.m;l.l=i.esposizione.l;l.t=i.esposizione.t;l.c=i.esposizione.c;l.f=i.esposizione.f;l.d=i.esposizione.d;l.y=i.esposizione.y;l.n=i.esposizione.n;l.r=i.esposizione.r;i.esposizione=angular.copy(l)}});h.saving=false;i.errore.esposizione=false}).error(function(l,k){console.log(k)})}else{i.errore.esposizione=true}}if(j=="C"){if(!e()){h.saving=true;g.post("php/esposizioni.php?type=new",{id:i.vm.nuovaEsposizione.i,mark:i.esposizione.m,line:i.esposizione.l,tbpr:i.esposizione.t,cod:i.esposizione.c,fin:i.esposizione.f,dim:i.esposizione.d,pos:i.esposizione.y,nome:i.esposizione.n,image:i.esposizione.r,sourceCod:i.esposizioneOriginal.esposizione.c,sourceMark:i.esposizioneOriginal.esposizione.m,sourceLine:i.esposizioneOriginal.esposizione.l,sourceFin:i.esposizioneOriginal.esposizione.f}).success(function(k){console.log("Risposta dalla pagina PHP",k);i.vm.copiedEsposizione={i:i.vm.nuovaEsposizione.i,m:i.esposizione.m,l:i.esposizione.l,t:i.esposizione.t,c:i.esposizione.c,f:i.esposizione.f,d:i.esposizione.d,y:i.esposizione.y,n:i.esposizione.n};i.vm.esposizioni.push(i.vm.copiedEsposizione);i.vm.nuovoComposto={i:i.vm.nuovoComposto.i+1};i.vm.saveEsposizioneData();h.saving=false;i.errore.esposizione=false}).error(function(l,k){console.log(k)})}else{i.errore.esposizione=true}}if(j=="D"){h.saving=true;g.post("php/esposizioni.php?type=delete",{id:i.esposizione.i,mark:i.esposizione.m,line:i.esposizione.l,tbpr:i.esposizione.t,cod:i.esposizione.c,fin:i.esposizione.f,dim:i.esposizione.d,pos:i.esposizione.y,nome:i.esposizione.n,image:i.esposizione.r}).success(function(k){console.log("Risposta dalla pagina PHP",k);i.vm.esposizioni=_.filter(i.vm.esposizioni,function(l){return l.i!=i.esposizione.i});i.vm.saveEsposizioneData();i.newItem()}).error(function(l,k){console.log(k)})}}}}});angular.module("mpuDashboard").directive("composti",function(){return{restrict:"E",templateUrl:"template/composti.html",scope:{compostoOriginal:"=",vm:"="},controller:function(i,g,b,h){i.errore={composto:false};function d(j){_.each(i.vm.marchi,function(k){if(k.i==j){markByName=k.n}});return markByName}function a(j){_.each(i.vm.linee,function(k){if(k.i==j){lineByName=k.n}});return lineByName}function f(j,l,k){return j.replace(new RegExp(l,"g"),k)}i.$watch("compostoOriginal",function(j){i.composto=angular.copy(j.composto);var k=d(i.composto.m);var l=a(i.composto.l);k=f(k," ","_");l=f(l," ","_");var m=f(i.composto.f," ","_");var n=l+"_"+i.composto.c+"C_"+m+".jpg";i.composto.r="../dashboard/archivio_dati/"+k+"/"+l+"/Render/"+n});i.confirm=false;i.askConfirm=function(){i.confirm=true;b(function(){i.confirm=false},4000)};i.updateCheck=function(){return(!i.composto.c||!i.composto.f||!i.composto.m||!i.composto.l||!i.composto.n||!i.composto.r||isNaN(i.composto.y))};i.deleteCheck=function(){return(i.composto.c!==i.compostoOriginal.composto.c||i.composto.m!==i.compostoOriginal.composto.m||i.composto.l!==i.compostoOriginal.composto.l||i.composto.f!==i.compostoOriginal.composto.f)};i.copyCheck=function(){return(!i.composto.c||!i.composto.m||!i.composto.l||!i.composto.f||(i.composto.c===i.compostoOriginal.composto.c&&i.composto.l===i.compostoOriginal.composto.l&&i.composto.f===i.compostoOriginal.composto.f))};var c=function(){if(i.composto.c!=i.compostoOriginal.composto.c||i.composto.l!=i.compostoOriginal.composto.l||i.composto.f!=i.compostoOriginal.composto.f){return _.findWhere(i.vm.composti,{c:i.composto.c,l:i.composto.l,f:i.composto.f})}else{return false}};var e=function(){return _.findWhere(i.vm.composti,{c:i.composto.c,m:i.composto.m,l:i.composto.l,f:i.composto.f})};i.newItem=function(){h.saving=false;i.errore.composto=false;i.compostoOriginal.selected=false;i.vm.nuovoComposto={i:i.vm.nuovoComposto.i+1,m:false,l:false,y:1}};i.action=function(j){if(j=="U"){if(!c()){h.saving=true;g.post("php/composti.php?type=update",{id:i.composto.i,mark:i.composto.m,line:i.composto.l,cod:i.composto.c,fin:i.composto.f,pos:i.composto.y,nome:i.composto.n,image:i.composto.r,sourceCod:i.compostoOriginal.composto.c,sourceMark:i.compostoOriginal.composto.m,sourceLine:i.compostoOriginal.composto.l,sourceFin:i.compostoOriginal.composto.f}).success(function(k){i.errore.composto=false;i.vm.saveCompostoData();console.log("Risposta dalla pagina PHP",k);_.each(i.vm.composti,function(l){if(l.i==i.composto.i){l.m=i.composto.m;l.l=i.composto.l;l.c=i.composto.c;l.f=i.composto.f;l.y=i.composto.y;l.n=i.composto.n;l.r=i.composto.r;i.composto=angular.copy(l)}});h.saving=false;i.errore.composto=false}).error(function(l,k){console.log(k)})}else{i.errore.composto=true}}if(j=="C"){if(!e()){h.saving=true;g.post("php/composti.php?type=new",{id:i.vm.nuovoComposto.i,mark:i.composto.m,line:i.composto.l,cod:i.composto.c,fin:i.composto.f,pos:i.composto.y,nome:i.composto.n,image:i.composto.r,sourceCod:i.compostoOriginal.composto.c,sourceMark:i.compostoOriginal.composto.m,sourceLine:i.compostoOriginal.composto.l,sourceFin:i.compostoOriginal.composto.f}).success(function(k){console.log("Risposta dalla pagina PHP",k);i.vm.copiedComposto={i:i.vm.nuovoComposto.i,m:i.composto.m,l:i.composto.l,c:i.composto.c,f:i.composto.f,y:i.composto.y,n:i.composto.n};i.vm.composti.push(i.vm.copiedComposto);i.vm.nuovoComposto={i:i.vm.nuovoComposto.i+1};i.vm.saveCompostoData();h.saving=false;i.errore.composto=false}).error(function(l,k){console.log(k)})}else{i.errore.composto=true}}if(j=="D"){h.saving=true;g.post("php/composti.php?type=delete",{id:i.composto.i,mark:i.composto.m,line:i.composto.l,cod:i.composto.c,fin:i.composto.f,pos:i.composto.y,nome:i.composto.n,image:i.composto.r}).success(function(k){console.log("Risposta dalla pagina PHP",k);i.vm.composti=_.filter(i.vm.composti,function(l){return l.i!=i.composto.i});i.vm.saveCompostoData();i.newItem()}).error(function(l,k){console.log(k)})}}}}});angular.module("mpuDashboard").directive("esposizioniProdotti",function(){return{restrict:"E",templateUrl:"template/esposizioniProdotti.html",scope:{esposizioneProdottoOriginal:"=",vm:"="},controller:function(b,d,c,a){b.$watch("esposizioneProdottoOriginal",function(e){b.esposizioneProdotto=angular.copy(e.esposizioneProdotto)});b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.$watch("esposizioneProdotto.p",function(g,f){if(g!=f&&b.esposizioneProdottoOriginal.i==b.esposizioneProdotto){b.esposizioneProdotto.u=false}if(g){var k=_.findWhere(b.vm.prodotti,{i:g});var e=_.pluck(k.z,"a");b.tabsAvailable=[];for(var h=0;h<e.length;h++){var j=_.findWhere(b.vm.finitureTabelle,{i:e[h]});b.tabsAvailable.push({i:e[h],n:j.n})}return b.tabsAvailable}});b.$watch("esposizioneProdotto.u",function(f,e){if(f!=e&&b.esposizioneProdottoOriginal.i==b.esposizioneProdotto){b.esposizioneProdotto.f=false}if(f){b.finsAvailable=_.where(b.vm.abbinamenti,{u:f});return b.finsAvailable}});b.newItem=function(){a.saving=false;b.esposizioneProdotto={i:b.vm.nuovoEsposizioneProdotto.i+1,c:false,p:false,m:false,k:false,l:false,j:false,u:false,f:false,y:1,q:1}};b.updateCheck=function(){return(!b.esposizioneProdotto.c||!b.esposizioneProdotto.p||!b.esposizioneProdotto.l||!b.esposizioneProdotto.j||!b.esposizioneProdotto.u||!b.esposizioneProdotto.f||isNaN(b.esposizioneProdotto.y)||isNaN(b.esposizioneProdotto.q))};b.action=function(e){if(e=="U"){a.saving=true;d.post("php/esposizioniProdotti.php?type=update",{id:b.esposizioneProdotto.i,comp:b.esposizioneProdotto.c,prd:b.esposizioneProdotto.p,pline:b.esposizioneProdotto.l,cline:b.esposizioneProdotto.j,pmark:b.esposizioneProdotto.m,cmark:b.esposizioneProdotto.k,fin:b.esposizioneProdotto.f,tab:b.esposizioneProdotto.u,pos:b.esposizioneProdotto.y,qnt:b.esposizioneProdotto.q}).success(function(f){b.vm.saveEsposizioniProdottiData();_.each(b.vm.esposizioniProdotti,function(g){if(g.i==b.esposizioneProdotto.i){g.c=b.esposizioneProdotto.c;g.p=b.esposizioneProdotto.p;g.l=b.esposizioneProdotto.l;g.j=b.esposizioneProdotto.j;g.m=b.esposizioneProdotto.m;g.k=b.esposizioneProdotto.k;g.f=b.esposizioneProdotto.f;g.u=b.esposizioneProdotto.u;g.y=b.esposizioneProdotto.y;g.q=b.esposizioneProdotto.q;b.esposizioneProdotto=angular.copy(g)}});a.saving=false}).error(function(g,f){console.log(f)})}if(e=="C"){a.saving=true;d.post("php/esposizioniProdotti.php?type=new",{id:b.vm.nuovoEsposizioneProdotto.i,comp:b.esposizioneProdotto.c,prd:b.esposizioneProdotto.p,pline:b.esposizioneProdotto.l,cline:b.esposizioneProdotto.j,pmark:b.esposizioneProdotto.m,cmark:b.esposizioneProdotto.k,fin:b.esposizioneProdotto.f,tab:b.esposizioneProdotto.u,pos:b.esposizioneProdotto.y,qnt:b.esposizioneProdotto.q}).success(function(f){console.log("Risposta dalla pagina PHP",f);b.vm.copiedEsposizioneProdotto={i:b.vm.nuovoEsposizioneProdotto.i,c:b.esposizioneProdotto.c,p:b.esposizioneProdotto.p,l:b.esposizioneProdotto.l,j:b.esposizioneProdotto.j,m:b.esposizioneProdotto.m,k:b.esposizioneProdotto.k,f:b.esposizioneProdotto.f,u:b.esposizioneProdotto.u,y:b.esposizioneProdotto.y,q:b.esposizioneProdotto.q};b.vm.esposizioniProdotti.push(b.vm.copiedEsposizioneProdotto);b.vm.nuovoEsposizioneProdotto={i:b.vm.nuovoEsposizioneProdotto.i+1};b.vm.saveEsposizioniProdottiData();a.saving=false}).error(function(g,f){console.log(f)})}if(e=="D"){a.saving=true;d.post("php/esposizioniProdotti.php?type=delete",{id:b.esposizioneProdotto.i,comp:b.esposizioneProdotto.c,prd:b.esposizioneProdotto.p,pline:b.esposizioneProdotto.l,cline:b.esposizioneProdotto.j,pmark:b.esposizioneProdotto.m,cmark:b.esposizioneProdotto.k,fin:b.esposizioneProdotto.f,tab:b.esposizioneProdotto.u,pos:b.esposizioneProdotto.y,qnt:b.esposizioneProdotto.q}).success(function(f){b.vm.esposizioniProdotti=_.filter(b.vm.esposizioniProdotti,function(g){return g.i!=b.esposizioneProdotto.i});b.vm.saveEsposizioniProdottiData();b.newItem()}).error(function(g,f){console.log(f)})}}}}});angular.module("mpuDashboard").directive("compostiProdotti",function(){return{restrict:"E",templateUrl:"template/compostiProdotti.html",scope:{compostoProdottoOriginal:"=",vm:"="},controller:function(b,d,c,a){b.$watch("compostoProdottoOriginal",function(e){b.compostoProdotto=angular.copy(e.compostoProdotto)});b.confirm=false;b.askConfirm=function(){b.confirm=true;c(function(){b.confirm=false},4000)};b.$watch("compostoProdotto.p",function(g,f){if(g!=f&&b.compostoProdottoOriginal.i==b.compostoProdotto){b.compostoProdotto.u=false}if(g){var k=_.findWhere(b.vm.prodotti,{i:g});var e=_.pluck(k.z,"a");b.tabsAvailable=[];for(var h=0;h<e.length;h++){var j=_.findWhere(b.vm.finitureTabelle,{i:e[h]});b.tabsAvailable.push({i:e[h],n:j.n})}return b.tabsAvailable}});b.$watch("compostoProdotto.u",function(f,e){if(f!=e&&b.compostoProdottoOriginal.i==b.compostoProdotto){b.compostoProdotto.f=false}if(f){b.finsAvailable=_.where(b.vm.abbinamenti,{u:f});return b.finsAvailable}});b.newItem=function(){a.saving=false;b.compostoProdotto={i:b.vm.nuovoCompostoProdotto.i+1,c:false,p:false,m:false,k:false,l:false,j:false,u:false,f:false,y:1,q:1}};b.updateCheck=function(){return(!b.compostoProdotto.c||!b.compostoProdotto.p||!b.compostoProdotto.l||!b.compostoProdotto.j||!b.compostoProdotto.u||!b.compostoProdotto.f||isNaN(b.compostoProdotto.y)||isNaN(b.compostoProdotto.q))};b.action=function(e){if(e=="U"){a.saving=true;d.post("php/compostiProdotti.php?type=update",{id:b.compostoProdotto.i,comp:b.compostoProdotto.c,prd:b.compostoProdotto.p,pline:b.compostoProdotto.l,cline:b.compostoProdotto.j,pmark:b.compostoProdotto.m,cmark:b.compostoProdotto.k,fin:b.compostoProdotto.f,tab:b.compostoProdotto.u,pos:b.compostoProdotto.y,qnt:b.compostoProdotto.q}).success(function(f){b.vm.saveCompostoProdottiData();_.each(b.vm.compostiProdotti,function(g){if(g.i==b.compostoProdotto.i){g.c=b.compostoProdotto.c;g.p=b.compostoProdotto.p;g.l=b.compostoProdotto.l;g.j=b.compostoProdotto.j;g.m=b.compostoProdotto.m;g.k=b.compostoProdotto.k;g.f=b.compostoProdotto.f;g.u=b.compostoProdotto.u;g.y=b.compostoProdotto.y;g.q=b.compostoProdotto.q;b.compostoProdotto=angular.copy(g)}});a.saving=false}).error(function(g,f){console.log(f)})}if(e=="C"){a.saving=true;d.post("php/compostiProdotti.php?type=new",{id:b.vm.nuovoCompostoProdotto.i,comp:b.compostoProdotto.c,prd:b.compostoProdotto.p,pline:b.compostoProdotto.l,cline:b.compostoProdotto.j,pmark:b.compostoProdotto.m,cmark:b.compostoProdotto.k,fin:b.compostoProdotto.f,tab:b.compostoProdotto.u,pos:b.compostoProdotto.y,qnt:b.compostoProdotto.q}).success(function(f){console.log("Risposta dalla pagina PHP",f);b.vm.copiedCompostoProdotto={i:b.vm.nuovoCompostoProdotto.i,c:b.compostoProdotto.c,p:b.compostoProdotto.p,l:b.compostoProdotto.l,j:b.compostoProdotto.j,m:b.compostoProdotto.m,k:b.compostoProdotto.k,f:b.compostoProdotto.f,u:b.compostoProdotto.u,y:b.compostoProdotto.y,q:b.compostoProdotto.q};b.vm.compostiProdotti.push(b.vm.copiedCompostoProdotto);b.vm.nuovoCompostoProdotto={i:b.vm.nuovoCompostoProdotto.i+1};b.vm.saveCompostoProdottiData();a.saving=false}).error(function(g,f){console.log(f)})}if(e=="D"){a.saving=true;d.post("php/compostiProdotti.php?type=delete",{id:b.compostoProdotto.i,comp:b.compostoProdotto.c,prd:b.compostoProdotto.p,pline:b.compostoProdotto.l,cline:b.compostoProdotto.j,pmark:b.compostoProdotto.m,cmark:b.compostoProdotto.k,fin:b.compostoProdotto.f,tab:b.compostoProdotto.u,pos:b.compostoProdotto.y,qnt:b.compostoProdotto.q}).success(function(f){b.vm.compostiProdotti=_.filter(b.vm.compostiProdotti,function(g){return g.i!=b.compostoProdotto.i});b.vm.saveCompostoProdottiData();b.newItem()}).error(function(g,f){console.log(f)})}}}}});angular.module("mpuDashboard").directive("esposizioniSettori",function(){return{restrict:"E",templateUrl:"template/esposizioniSettori.html",scope:{esposizioneSettoreOriginal:"=",vm:"="},controller:function(c,f,d,b,a){c.$watch("esposizioneSettoreOriginal",function(g){c.esposizioneSettore=angular.copy(g.esposizioneSettore)});c.saveDataDB=function(){b.saving=true;f.post("php/esposizioniSettori.php?type=db").success(function(){b.saving=false;a.esposizioniSettori().then(function(g){c.vm.esposizioniSettori=g})}).error(function(h,g){console.log(g)})};c.errore={esposizioneSettore:false};c.confirm=false;c.askConfirm=function(){c.confirm=true;d(function(){c.confirm=false},4000)};c.convert=function(g,j,i){var h="";_.each(c.vm[j],function(k){if(k.i==g){h=k[i]}});return h};c.$watch("esposizioneSettore",function(g){c.esposizioniAvailable=[{c:" Tutti",i:-1},{c:c.convert(c.esposizioneSettore.c,"esposizioni","c")+"_"+c.convert(c.esposizioneSettore.c,"esposizioni","f"),i:c.esposizioneSettore.c}];var h=_.where(c.vm.esposizioni,{l:c.esposizioneSettore.l});_.each(h,function(i){if(!_.find(c.vm.esposizioniSettori,function(j){return(j.c===i.i&&g.l===i.l)})){c.esposizioniAvailable.push(i)}})});c.$watch("esposizioneSettore.w",function(g){c.settoriAvailable=_.where(c.vm.lineeSettori,{l:g});_.each(c.settoriAvailable,function(h){h.n=_.findWhere(c.vm.settori,{i:h.h}).n})});c.selectedCat=function(g){return(c.esposizioneSettore.h.indexOf(g)!=-1)};c.toggleSet=function(g){if(c.esposizioneSettore.h.indexOf(g)==-1){c.esposizioneSettore.h.push(parseInt(g))}else{c.esposizioneSettore.h.splice(c.esposizioneSettore.h.indexOf(g),1)}};c.updateCheck=function(){return(c.esposizioneSettore.c==-1)};c.enableUpdate=false;c.$watchCollection("esposizioneSettore.h",function(g){if(c.esposizioneSettore.i==c.esposizioneSettoreOriginal.esposizioneSettore.i&&g!=c.esposizioneSettoreOriginal.h){c.enableUpdate=true}});c.copyCheck=function(){return(c.esposizioneSettore.c==-1||c.esposizioneSettore.c===c.esposizioneSettoreOriginal.esposizioneSettore.c)};function e(){return c.esposizioneSettore.h.length}c.newItem=function(){b.saving=false;c.errore.esposizioneSettore=false;c.esposizioneSettoreOriginal.selected=false;c.vm.nuovoEsposizioneSettore={i:c.vm.nuovoEsposizioneSettore.i+1,m:false,l:false,c:false,v:0,h:[]}};c.action=function(g){if(g=="U"){if(e()!=0){b.saving=true;f.post("php/esposizioniSettori.php?type=update",{id:c.esposizioneSettore.i,cod:c.esposizioneSettore.c,mark:c.esposizioneSettore.m,line:c.esposizioneSettore.l,nwln:c.esposizioneSettore.w,array:c.esposizioneSettore.h,view:c.esposizioneSettore.v}).success(function(h){_.each(c.vm.esposizioniSettori,function(j,i){if(j.i==c.esposizioneSettore.i){j.c=c.esposizioneSettore.c;j.n=c.esposizioneSettore.n;j.m=c.esposizioneSettore.m;j.l=c.esposizioneSettore.l;j.w=c.esposizioneSettore.w;j.h=c.esposizioneSettore.h;j.v=c.esposizioneSettore.v;c.esposizioneSettore=angular.copy(j)}});b.saving=false;c.errore.esposizioneSettore=false;c.vm.saveEsposizioneSettoreData()}).error(function(i,h){console.log(h)})}else{c.errore.esposizioneSettore=true}}if(g=="C"){if(e()!=0){b.saving=true;f.post("php/esposizioniSettori.php?type=new",{id:c.vm.nuovoEsposizioneSettore.i,cod:c.esposizioneSettore.c,mark:c.esposizioneSettore.m,line:c.esposizioneSettore.l,nwln:c.esposizioneSettore.w,view:c.esposizioneSettore.v,array:c.esposizioneSettore.h}).success(function(h){c.vm.copiedEsposizioneSettore={i:c.vm.nuovoEsposizioneSettore.i,c:c.esposizioneSettore.c,n:c.esposizioneSettore.n,m:c.esposizioneSettore.m,l:c.esposizioneSettore.l,w:c.esposizioneSettore.w,v:c.esposizioneSettore.v,h:c.esposizioneSettore.h};c.vm.esposizioniSettori.push(c.vm.copiedEsposizioneSettore);c.vm.nuovoEsposizioneSettore={i:c.vm.nuovoEsposizioneSettore.i+1};c.vm.saveEsposizioneSettoreData();b.saving=false;c.errore.esposizioneSettore=false}).error(function(i,h){console.log(h)})}else{c.errore.esposizioneSettore=true}}if(g=="D"){b.saving=true;f.post("php/esposizioniSettori.php?type=delete",{id:c.esposizioneSettore.i,cod:c.esposizioneSettore.c,mark:c.esposizioneSettore.m,line:c.esposizioneSettore.l,nwln:c.esposizioneSettore.w,view:c.esposizioneSettore.v,array:c.esposizioneSettore.h}).success(function(h){if(c.esposizioneSettore.c!=-1){c.vm.esposizioniSettori=_.filter(c.vm.esposizioniSettori,function(i){return i.i!=c.esposizioneSettore.i});c.vm.saveEsposizioneSettoreData()}else{c.saveDataDB()}c.newItem()}).error(function(i,h){console.log(h)})}}}}});angular.module("mpuDashboard").directive("compostiSettori",function(){return{restrict:"E",templateUrl:"template/compostiSettori.html",scope:{compostoSettoreOriginal:"=",vm:"="},controller:function(c,f,d,b,a){c.$watch("compostoSettoreOriginal",function(g){c.compostoSettore=angular.copy(g.compostoSettore)});c.saveDataDB=function(){b.saving=true;f.post("php/compostiSettori.php?type=db").success(function(){b.saving=false;a.compostiSettori().then(function(g){c.vm.compostiSettori=g})}).error(function(h,g){console.log(g)})};c.errore={compostoSettore:false};c.confirm=false;c.askConfirm=function(){c.confirm=true;d(function(){c.confirm=false},4000)};c.convert=function(g,j,i){var h="";_.each(c.vm[j],function(k){if(k.i==g){h=k[i]}});return h};c.$watch("compostoSettore",function(g){c.compostiAvailable=[{c:" Tutti",i:-1},{c:c.convert(c.compostoSettore.c,"composti","c")+"_"+c.convert(c.compostoSettore.c,"composti","f"),i:c.compostoSettore.c}];var h=_.where(c.vm.composti,{l:c.compostoSettore.l});_.each(h,function(i){if(!_.find(c.vm.compostiSettori,function(j){return(j.c===i.i&&g.l===i.l)})){c.compostiAvailable.push(i)}})});c.$watch("compostoSettore.w",function(g){c.settoriAvailable=_.where(c.vm.lineeSettori,{l:g});_.each(c.settoriAvailable,function(h){h.n=_.findWhere(c.vm.settori,{i:h.h}).n})});c.selectedCat=function(g){return(c.compostoSettore.h.indexOf(g)!=-1)};c.toggleSet=function(g){if(c.compostoSettore.h.indexOf(g)==-1){c.compostoSettore.h.push(parseInt(g))}else{c.compostoSettore.h.splice(c.compostoSettore.h.indexOf(g),1)}};c.updateCheck=function(){return(c.compostoSettore.c==-1)};c.enableUpdate=false;c.$watchCollection("compostoSettore.h",function(g){if(c.compostoSettore.i==c.compostoSettoreOriginal.compostoSettore.i&&g!=c.compostoSettoreOriginal.h){c.enableUpdate=true}});c.copyCheck=function(){return(c.compostoSettore.c==-1||c.compostoSettore.c===c.compostoSettoreOriginal.compostoSettore.c)};function e(){return c.compostoSettore.h.length}c.newItem=function(){b.saving=false;c.errore.compostoSettore=false;c.compostoSettoreOriginal.selected=false;c.vm.nuovoCompostoSettore={i:c.vm.nuovoCompostoSettore.i+1,m:false,l:false,c:false,v:0,h:[]}};c.action=function(g){if(g=="U"){if(e()!=0){b.saving=true;f.post("php/compostiSettori.php?type=update",{id:c.compostoSettore.i,cod:c.compostoSettore.c,mark:c.compostoSettore.m,line:c.compostoSettore.l,nwln:c.compostoSettore.w,array:c.compostoSettore.h,view:c.compostoSettore.v}).success(function(h){_.each(c.vm.compostiSettori,function(j,i){if(j.i==c.compostoSettore.i){j.c=c.compostoSettore.c;j.n=c.compostoSettore.n;j.m=c.compostoSettore.m;j.l=c.compostoSettore.l;j.w=c.compostoSettore.w;j.h=c.compostoSettore.h;j.v=c.compostoSettore.v;c.compostoSettore=angular.copy(j)}});b.saving=false;c.errore.compostoSettore=false;c.vm.saveCompostoSettoreData()}).error(function(i,h){console.log(h)})}else{c.errore.compostoSettore=true}}if(g=="C"){if(e()!=0){b.saving=true;f.post("php/compostiSettori.php?type=new",{id:c.vm.nuovoCompostoSettore.i,cod:c.compostoSettore.c,mark:c.compostoSettore.m,line:c.compostoSettore.l,nwln:c.compostoSettore.w,view:c.compostoSettore.v,array:c.compostoSettore.h}).success(function(h){c.vm.copiedCompostoSettore={i:c.vm.nuovoCompostoSettore.i,c:c.compostoSettore.c,n:c.compostoSettore.n,m:c.compostoSettore.m,l:c.compostoSettore.l,w:c.compostoSettore.w,v:c.compostoSettore.v,h:c.compostoSettore.h};c.vm.compostiSettori.push(c.vm.copiedCompostoSettore);c.vm.nuovoCompostoSettore={i:c.vm.nuovoCompostoSettore.i+1};c.vm.saveCompostoSettoreData();b.saving=false;c.errore.compostoSettore=false}).error(function(i,h){console.log(h)})}else{c.errore.compostoSettore=true}}if(g=="D"){b.saving=true;f.post("php/compostiSettori.php?type=delete",{id:c.compostoSettore.i,cod:c.compostoSettore.c,mark:c.compostoSettore.m,line:c.compostoSettore.l,nwln:c.compostoSettore.w,view:c.compostoSettore.v,array:c.compostoSettore.h}).success(function(h){if(c.compostoSettore.c!=-1){c.vm.compostiSettori=_.filter(c.vm.compostiSettori,function(i){return i.i!=c.compostoSettore.i});c.vm.saveCompostoSettoreData()}else{c.saveDataDB()}c.newItem()}).error(function(i,h){console.log(h)})}}}}});