angular.module("mpu").directive("clearInputWithEsc",[function(){return{restrict:"A",require:"?ngModel",link:function(d,c,a,b){c.on("keydown keypress",function(f){if(f.keyCode!=27){return}d.$apply(function(){b.$setViewValue("");b.$render()})})}}}]);angular.module("mpu").directive("hoverClass",function(){return{restrict:"A",link:function(b,a){a.on("mouseenter",function(){a.addClass("hover")});a.on("mouseleave",function(){a.removeClass("hover")});a.on("click",function(){a.removeClass("hover")})}}});angular.module("mpu").directive("hoverClassSvg",function(){return{restrict:"A",link:function(c,a){var b="hover";a.on("mouseenter",function(){if(!a.hasClass(b)){a.attr("class",a.attr("class")+" "+b)}});a.on("mouseleave",function(){var d=a.attr("class").replace(new RegExp("(\\s|^)"+b+"(\\s|$)","g"),"$2");a.attr("class",d)});a.on("click",function(){var d=a.attr("class").replace(new RegExp("(\\s|^)"+b+"(\\s|$)","g"),"$2");a.attr("class",d)})}}});angular.module("mpu").directive("imageonload",function(){return{scope:{loaded:"="},restrict:"A",link:function(c,b,a){b.bind("load",function(){c.loaded=true})}}});angular.module("mpu").directive("categoria",function(){return{restrict:"E",templateUrl:"templates/categoria.html",scope:{categoria:"=",fnz:"="},controller:["$scope",function(a){a.categoria.r="url('dashboard/archivio_dati/Categorie/"+a.categoria.i+".jpg') no-repeat right"}]}});angular.module("mpu").directive("settori",function(){return{restrict:"E",templateUrl:"templates/settori.html",scope:{settore:"="},controller:["$scope",function(a){a.settore.r="url('dashboard/archivio_dati/Settori/"+a.settore.i+".jpg') no-repeat right"}]}});angular.module("mpu").directive("linea",function(){return{restrict:"E",templateUrl:"templates/linea.html",scope:{linea:"=",fnz:"=",vetrine:"=",marchi:"="},controller:["$scope","$rootScope","$timeout",function(a,c,b){b(function(){a.info=false;a.imgList=_.pluck(_.filter(a.vetrine,function(g){return g.l==a.linea.i}),"c");var f=_.find(a.marchi,function(g){return g.i==a.linea.m});if(f.d&&f.d!=0){a.consegna=f.d}else{a.consegna=a.linea.e}var d=a.fnz.convert(a.linea.m,"marchi","n");d=a.fnz.replaceAll(d," ","_");var e=a.fnz.replaceAll(a.linea.n," ","_");a.path="dashboard/archivio_dati/"+d+"/"+e+"/Vetrina/"+e;a.pdfPath="dashboard/archivio_dati/"+d+"/"+e+"/"+e})}]}});angular.module("mpu").directive("newlinea",function(){return{restrict:"E",templateUrl:"templates/newlinea.html",scope:{linea:"=",fnz:"=",vetrine:"=",marchi:"="},controller:["$scope","$rootScope","$timeout",function(a,c,b){b(function(){a.info=false;a.imgList=_.pluck(_.filter(a.vetrine,function(g){return g.l==a.linea.i}),"c");var f=_.find(a.marchi,function(g){return g.i==a.linea.m});if(f.d&&f.d!=0){a.consegna=f.d}else{a.consegna=a.linea.e}var d=a.fnz.convert(a.linea.m,"marchi","n");d=a.fnz.replaceAll(d," ","_");var e=a.fnz.replaceAll(a.linea.n," ","_");a.path=a.fnz.findDomain()+"/dashboard/archivio_dati/"+d+"/"+e+"/Vetrina/"+e;a.linea.r=a.fnz.findDomain()+"/dashboard/archivio_dati/"+d+"/"+e+"/"+e+".jpg";a.pdfPath=a.fnz.findDomain()+"/dashboard/archivio_dati/"+d+"/"+e+"/"+e})}]}});angular.module("mpu").directive("composizioni",function(){return{restrict:"E",templateUrl:"templates/composizioni.html",scope:{item:"=",fnz:"=",lista:"=",prodotti:"=",marchi:"=",linee:"=",type:"@"},controller:["$scope","$timeout",function(a,b){a.loaded=false;a.info=false;var d=function(){var g=0;var f=_.where(a.lista,{c:a.item.i});_.each(f,function(h){var k=_.findWhere(a.prodotti,{i:h.p});var i=_.find(a.marchi,function(l){return l.i==h.k});var j=_.find(a.linee,function(l){return l.i==h.j});_.each(k.z,function(l){if(l.a===h.u){var m=a.fnz.scontistica(l.z,i.s,i.b,j.s);g+=m*h.q}})});return a.cmpPrice=a.fnz.convertPrice(g)};b(d);var c=a.fnz.convert(a.item.m,"marchi","n");var e=a.fnz.convert(a.item.l,"linee","n");c=a.fnz.replaceAll(c," ","_");e=a.fnz.replaceAll(e," ","_");switch(a.type){case"vtr":a.path="dashboard/archivio_dati/"+c+"/"+e+"/Vetrina/"+e+"_"+a.item.c+".jpg";break;case"cmp":a.path="dashboard/archivio_dati/"+c+"/"+e+"/Render/"+e+"_"+a.item.c+"C_"+a.item.f+".jpg";break;case"vetrina":a.path="dashboard/archivio_dati/"+c+"/"+e+"/Render/"+e+"_"+a.item.c+"_"+a.item.f+".jpg";break}}]}});angular.module("mpu").directive("listino",function(){return{restrict:"E",templateUrl:"templates/listino.html",scope:{articolo:"=",marchi:"=",linee:"=",fnz:"=",loc:"="},controller:["$scope","$location",function(a,g){a.settore=g.search().s;a.linea=g.search().l;a.loaded=false;var b=a.fnz.convert(a.articolo.m,"marchi","n");b=a.fnz.replaceAll(b," ","_");var d=a.fnz.convert(a.articolo.l,"linee","n");d=a.fnz.replaceAll(d," ","_");var e=_.find(a.marchi,function(h){return h.i==a.articolo.m});var f=_.find(a.linee,function(h){return h.i==a.articolo.l});a.path="dashboard/archivio_dati/"+b+"/"+d+"/Prodotti/"+a.articolo.c+".jpg";if(a.articolo.z.length==1){a.price="prezzo: "+a.fnz.convertPrice(a.fnz.scontistica(a.articolo.z[0].z,e.s,e.b,f.s))}else{var c=_.min(_.pluck(a.articolo.z,"z"));a.price="a partire da: "+a.fnz.convertPrice(a.fnz.scontistica(c,e.s,e.b,f.s))}}]}});angular.module("mpu").directive("composizione",function(){return{restrict:"E",templateUrl:"templates/composizione.html",scope:{item:"=",dt:"=",fnz:"="},controller:["$scope",function(c){var f;var g=_.find(c.dt.marchi,function(h){return h.i==c.item.m});var d=g.n;var e=_.find(c.dt.linee,function(h){return h.i==c.item.l}).n;d=c.fnz.replaceAll(d," ","_");e=c.fnz.replaceAll(e," ","_");c.item.z=0;c.item.pdfPath="dashboard/archivio_dati/"+d+"/"+e+"/"+e;c.item.nome=e+"_"+c.item.c;c.item.type="vtr";c.item.path="dashboard/archivio_dati/"+d+"/"+e+"/Vetrina/"+e+"_"+c.item.c+".jpg";var b=[];var a=[];_.each(c.item.p,function(h){var m=_.find(c.dt.prodotti,function(n){return n.i==h.p});h.cmp=h.c;h.cod=m.c;h.n=m.n;h.d=m.d;h.i=m.i;h.o=m.o;h.t=m.t;var i=_.find(m.z,function(n){return n.a==h.u}).z;var k=_.find(c.dt.marchi,function(n){return n.i==h.m});var l=_.find(c.dt.linee,function(n){return n.i==m.l});h.marchio=c.fnz.replaceAll(k.n," ","_");h.linea=c.fnz.replaceAll(l.n," ","_");h.path="dashboard/archivio_dati/"+h.marchio+"/"+h.linea+"/Prodotti/"+h.cod+".jpg";var j=c.fnz.scontistica(i,k.s,k.b,l.s);if(k.d&&k.d!=0){h.consegna=k.d}else{h.consegna=l.e}h.garanzia=l.w;b.push(l.e);a.push(l.w);h.raw=j;h.selectedTab={a:h.u,price:c.fnz.convertPrice(j),z:i};h.price=c.fnz.convertPrice(j);c.item.z+=j*h.q});if(g.d&&g.d!=0){c.item.consegna=g.d}else{c.item.consegna=_.max(b)}c.item.garanzia=_.min(a);c.item.price=c.fnz.convertPrice(c.item.z)}]}});angular.module("mpu").directive("prodotti",function(){return{restrict:"E",templateUrl:"templates/prodotti.html",scope:{item:"=",fnz:"=",current:"=",abb:"="},controller:["$scope",function(a){a.item.selectedFin=_.find(a.abb,function(b){return b.i==a.item.f})}]}});angular.module("mpu").directive("articolo",function(){return{restrict:"E",templateUrl:"templates/articolo.html",scope:{prodotti:"=",fnz:"=",abb:"=",sett:"=",tbpr:"=",prv:"=",vm:"="},controller:["$scope","$timeout","$location","$http",function(c,d,f,e){c.resetFin=function(){c.item.selectedFin=false;c.item.selectedTab=false;c.item.q=1};c.item={};c.item.selectedFin=false;c.item.selectedTab=false;var a=f.search().a;var b=function(g){if(e.pendingRequests.length>0){d(function(){b(g)})}else{c.item=_.find(c.prodotti,function(k){return k.i==g});var i=_.find(c.vm.marchi,function(k){return k.i==c.item.m});var j=_.find(c.vm.linee,function(k){return k.i==c.item.l});if(c.item.z.length==1){c.item.price=c.fnz.convertPrice(c.fnz.scontistica(c.item.z[0].z,i.s,i.b,j.s));c.item.raw=c.fnz.scontistica(c.item.z[0].z,i.s,i.b,j.s)}else{var h=_.min(_.pluck(c.item.z,"z"));c.item.price="a partire da "+c.fnz.convertPrice(c.fnz.scontistica(h,i.s,i.b,j.s));c.item.raw=c.fnz.scontistica(h,i.s,i.b,j.s)}c.item.marchio=c.fnz.replaceAll(i.n," ","_");c.item.linea=c.fnz.replaceAll(j.n," ","_");c.item.path=f.protocol()+"://"+f.host()+"/dashboard/archivio_dati/"+c.item.marchio+"/"+c.item.linea+"/Prodotti/"+c.item.c+".jpg";_.each(c.item.z,function(k){k.price=c.fnz.convertPrice(c.fnz.scontistica(k.z,i.s,i.b,j.s));c.item.finElements=[];c.item.fin=_.filter(c.abb,function(m){return m.u==k.a});for(var l=0;l<c.item.fin[0].f.length;l++){c.item.finElements.push(c.item.fin[0].f[l].n)}});c.item.cod=c.item.c;if(i.d&&i.d!=0){c.item.consegna=i.d}else{c.item.consegna=j.e}c.item.garanzia=j.w;c.item.q=1;c.tbpr=c.item.t}};d(function(){b(a)});c.item.abb=_.find(c.abb,function(g){return g.i==c.item.f})}]}});angular.module("mpu").directive("finiture",function(){return{restrict:"E",templateUrl:"templates/finiture.html",scope:{item:"=",fnz:"=",abb:"=",z:"="},controller:["$scope",function(a){a.dir={showTab:false};a.uniqFin=function(e,d){var b=_.filter(a.abb,function(f){return f.u==e});var c=[];_.each(b,function(f){_.each(f.f,function(g,h){if(!_.contains(c,g.i)&&h==d){c.push(g.i)}})});return _.uniq(c)};a.filtroFiniture={};a.filtroFiniture[0]=false;a.filtroFiniture[1]=false;a.filtroFiniture[2]=false;a.filtroFiniture[3]=false;a.filtroFiniture[4]=false;a.filtroFiniture[5]=false;a.filtroFiniture[6]=false}]}});angular.module("mpu").directive("preventivo",function(){return{restrict:"E",templateUrl:"templates/preventivo.html",scope:{fnz:"=",articolo:"=",prodotti:"=",prv:"=",vm:"="},controller:["$scope","$timeout","$http","$cookies",function(b,d,e,c){b.$watchCollection("articolo",function(h){var g=_.find(b.prv.list,function(i){return i.c==h.c});var f=b.prv.list.indexOf(g);b.prv.list[f]=h;c.putObject("MPU-P",b.prv);b.$emit("prv.list")});var a=function(f){var m=_.find(b.prodotti,function(n){return n.i==f});b.item=angular.copy(m);b.item.abb=_.find(b.vm.abbinamenti,function(n){return n.i==b.articolo.a});var i=_.find(b.vm.marchi,function(n){return n.i==b.item.m});var k=_.find(b.vm.linee,function(n){return n.i==b.item.l});b.item.price=b.fnz.convertPrice(b.articolo.z);b.item.linea=k.n;var g=b.fnz.replaceAll(i.n," ","_");var l=b.fnz.replaceAll(k.n," ","_");var j="dashboard/archivio_dati/"+g+"/"+l+"/";b.item.pathPdf=j+l+"_specifiche.pdf";b.item.pathImg=j+"Prodotti/"+b.item.c+".jpg";b.item.pathFin="dashboard/archivio_dati/"+g+"/Finiture/";if(i.d&&i.d!=0){b.item.consegna=i.d}else{b.item.consegna=k.e}b.item.garanzia=k.w;b.item.q=1;b.tbpr=b.item.t;var h=_.find(b.vm.finitureTabelle,function(n){return n.i==b.articolo.u});b.item.u=h.n;delete b.item.a;delete b.item.f;delete b.item.m;delete b.item.y;delete b.item.x;delete b.item.z;delete b.item.q};d(function(){a(b.articolo.i)});b.dir={};b.dir.add=function(){b.articolo.q++};b.dir.remove=function(){if(b.articolo.q>1){b.articolo.q--}};b.dir.checkQnt=function(f){if(f<=0||isNaN(f)||!f){b.articolo.q=1}};b.dir.confirm=false;b.dir.askConfirm=function(){b.dir.confirm=true;d(function(){b.dir.confirm=false},4000)}}]}});angular.module("mpu").directive("email",function(){return{restrict:"E",templateUrl:"templates/email.html",scope:{cod:"=",change:"=",vm:"=",path:"=",type:"@",linea:"@"},controller:["$scope","$http","$timeout",function(a,c,b){a.email={success:false,error:false};a.email.send=function(){switch(a.type){case"menu":c.post("php/email.php",{type:a.type,from:a.email.from,to:a.email.to}).success(function(d){if(parseInt(d)==1){a.email.success=true;b(function(){a.vm.menuEmail=false;a.email.success=false;a.change=false},4000)}else{a.email.error=true;b(function(){a.email.error=false},4000)}});break;case"dwg":c.post("php/email.php",{type:a.type,from:a.email.from,nome:a.email.nome,tel:a.email.tel,linea:a.linea}).success(function(d){if(parseInt(d)==1){a.email.success=true;b(function(){a.vm.dwgEmail=false;a.email.success=false},4000)}else{a.email.error=true;b(function(){a.email.error=false},4000)}});break;case"prodotti":c.post("php/email.php",{type:a.type,from:a.email.from,to:a.email.to,path:a.path}).success(function(d){if(parseInt(d)==1){a.email.success=true;b(function(){a.vm.prdEmail=false;a.email.success=false;a.change=false},4000)}else{a.email.error=true;b(function(){a.email.error=false},4000)}});break;case"preventivo":c.post("php/email.php",{cod:a.cod,type:a.type,from:a.email.from,to:a.email.to,loc:a.vm.loc}).success(function(d){if(parseInt(d)==1){a.email.success=true;b(function(){a.vm.prvEmail=false;a.email.success=false;a.change=false},4000)}else{a.email.error=true;b(function(){a.email.error=false},4000)}});break}}}]}});angular.module("mpu").directive("request",function(){return{restrict:"E",templateUrl:"templates/request.html",scope:{request:"=",prv:"=",riv:"="},controller:["$scope","$http","$timeout",function(a,c,b){a.request.success=false;a.request.error=false;a.request.sending=false;a.request.send=function(){a.request.sending=true;c.post("php/email.php",{type:"request",data:a.request}).success(function(d){a.request.sending=false;if(parseInt(d)==1){a.request.success=true;b(function(){a.request.success=false;a.request.u=false},2000)}else{a.request.error=true;b(function(){a.request.error=false},4000)}})}}]}});